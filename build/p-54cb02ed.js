import{k as n,m as t}from"./p-14a93dff.js";import{o as r,s as e}from"./p-e88f731b.js";import{D as i}from"./p-954d5885.js";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.
THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var u=function(){return(u=Object.assign||function(n){for(var t,r=1,e=arguments.length;r<e;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n}).apply(this,arguments)};function o(n,t,r){if(r||2===arguments.length)for(var e,i=0,u=t.length;i<u;i++)!e&&i in t||(e||(e=Array.prototype.slice.call(t,0,i)),e[i]=t[i]);return n.concat(e||Array.prototype.slice.call(t))}var f="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,a=Object.keys,c=Array.isArray;function s(n,t){return"object"!=typeof t||a(t).forEach((function(r){n[r]=t[r]})),n}"undefined"==typeof Promise||f.Promise||(f.Promise=Promise);var l=Object.getPrototypeOf,h={}.hasOwnProperty;function v(n,t){return h.call(n,t)}function d(n,t){"function"==typeof t&&(t=t(l(n))),("undefined"==typeof Reflect?a:Reflect.ownKeys)(t).forEach((function(r){p(n,r,t[r])}))}var y=Object.defineProperty;function p(n,t,r,e){y(n,t,s(r&&v(r,"get")&&"function"==typeof r.get?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},e))}function w(n){return{from:function(t){return n.prototype=Object.create(t.prototype),p(n.prototype,"constructor",n),{extend:d.bind(null,n.prototype)}}}}var m=Object.getOwnPropertyDescriptor;function g(n,t){var r;return m(n,t)||(r=l(n))&&g(r,t)}var b=[].slice;function x(n,t,r){return b.call(n,t,r)}function k(n,t){return t(n)}function E(n){if(!n)throw new Error("Assertion Failed")}function A(n){f.setImmediate?setImmediate(n):setTimeout(n,0)}function P(n,t){return n.reduce((function(n,r,e){var i=t(r,e);return i&&(n[i[0]]=i[1]),n}),{})}function j(n,t){if(v(n,t))return n[t];if(!t)return n;if("string"!=typeof t){for(var r=[],e=0,i=t.length;e<i;++e){var u=j(n,t[e]);r.push(u)}return r}var o=t.indexOf(".");if(-1!==o){var f=n[t.substr(0,o)];return void 0===f?void 0:j(f,t.substr(o+1))}}function S(n,t,r){if(n&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(n)))if("string"!=typeof t&&"length"in t){E("string"!=typeof r&&"length"in r);for(var e=0,i=t.length;e<i;++e)S(n,t[e],r[e])}else{var u=t.indexOf(".");if(-1!==u){var o=t.substr(0,u),f=t.substr(u+1);if(""===f)void 0===r?c(n)&&!isNaN(parseInt(o))?n.splice(o,1):delete n[o]:n[o]=r;else{var a=n[o];a&&v(n,o)||(a=n[o]={}),S(a,f,r)}}else void 0===r?c(n)&&!isNaN(parseInt(t))?n.splice(t,1):delete n[t]:n[t]=r}}function I(n){var t={};for(var r in n)v(n,r)&&(t[r]=n[r]);return t}var O=[].concat;function D(n){return O.apply([],n)}var C="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(D([8,16,32,64].map((function(n){return["Int","Uint","Float"].map((function(t){return t+n+"Array"}))})))).filter((function(n){return f[n]})),R=C.map((function(n){return f[n]}));P(C,(function(n){return[n,!0]}));var T=null;function K(n){T="undefined"!=typeof WeakMap&&new WeakMap;var t=B(n);return T=null,t}function B(n){if(!n||"object"!=typeof n)return n;var t=T&&T.get(n);if(t)return t;if(c(n)){t=[],T&&T.set(n,t);for(var r=0,e=n.length;r<e;++r)t.push(B(n[r]))}else if(R.indexOf(n.constructor)>=0)t=n;else{var i=l(n);for(var u in t=i===Object.prototype?{}:Object.create(i),T&&T.set(n,t),n)v(n,u)&&(t[u]=B(n[u]))}return t}var M={}.toString;function q(n){return M.call(n).slice(8,-1)}var N="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",F="symbol"==typeof N?function(n){var t;return null!=n&&(t=n[N])&&t.apply(n)}:function(){return null},U={};function _(n){var t,r,e,i;if(1===arguments.length){if(c(n))return n.slice();if(this===U&&"string"==typeof n)return[n];if(i=F(n)){for(r=[];!(e=i.next()).done;)r.push(e.value);return r}if(null==n)return[n];if("number"==typeof(t=n.length)){for(r=new Array(t);t--;)r[t]=n[t];return r}return[n]}for(t=arguments.length,r=new Array(t);t--;)r[t]=arguments[t];return r}var L="undefined"!=typeof Symbol?function(n){return"AsyncFunction"===n[Symbol.toStringTag]}:function(){return!1},V="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function G(n,t){V=n,W=t}var W=function(){return!0},H=!new Error("").stack;function J(){if(H)try{throw new Error}catch(n){return n}return new Error}function Y(n,t){var r=n.stack;return r?(t=t||0,0===r.indexOf(n.name)&&(t+=(n.name+n.message).split("\n").length),r.split("\n").slice(t).filter(W).map((function(n){return"\n"+n})).join("")):""}var z=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Q=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(z),$={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function X(n,t){this._e=J(),this.name=n,this.message=t}function Z(n,t){return n+". Errors: "+Object.keys(t).map((function(n){return t[n].toString()})).filter((function(n,t,r){return r.indexOf(n)===t})).join("\n")}function nn(n,t,r,e){this._e=J(),this.failures=t,this.failedKeys=e,this.successCount=r,this.message=Z(n,t)}function tn(n,t){this._e=J(),this.name="BulkError",this.failures=Object.keys(t).map((function(n){return t[n]})),this.failuresByPos=t,this.message=Z(n,t)}w(X).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Y(this._e,2))}},toString:function(){return this.name+": "+this.message}}),w(nn).from(X),w(tn).from(X);var rn=Q.reduce((function(n,t){return n[t]=t+"Error",n}),{}),en=X,un=Q.reduce((function(n,t){var r=t+"Error";function e(n,e){this._e=J(),this.name=r,n?"string"==typeof n?(this.message=n+(e?"\n "+e:""),this.inner=e||null):"object"==typeof n&&(this.message=n.name+" "+n.message,this.inner=n):(this.message=$[t]||r,this.inner=null)}return w(e).from(en),n[t]=e,n}),{});un.Syntax=SyntaxError,un.Type=TypeError,un.Range=RangeError;var on=z.reduce((function(n,t){return n[t+"Error"]=un[t],n}),{}),fn=Q.reduce((function(n,t){return-1===["Syntax","Type","Range"].indexOf(t)&&(n[t+"Error"]=un[t]),n}),{});function an(){}function cn(n){return n}function sn(n,t){return null==n||n===cn?t:function(r){return t(n(r))}}function ln(n,t){return function(){n.apply(this,arguments),t.apply(this,arguments)}}function hn(n,t){return n===an?t:function(){var r=n.apply(this,arguments);void 0!==r&&(arguments[0]=r);var e=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var u=t.apply(this,arguments);return e&&(this.onsuccess=this.onsuccess?ln(e,this.onsuccess):e),i&&(this.onerror=this.onerror?ln(i,this.onerror):i),void 0!==u?u:r}}function vn(n,t){return n===an?t:function(){n.apply(this,arguments);var r=this.onsuccess,e=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?ln(r,this.onsuccess):r),e&&(this.onerror=this.onerror?ln(e,this.onerror):e)}}function dn(n,t){return n===an?t:function(r){var e=n.apply(this,arguments);s(r,e);var i=this.onsuccess,u=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?ln(i,this.onsuccess):i),u&&(this.onerror=this.onerror?ln(u,this.onerror):u),void 0===e?void 0===o?void 0:o:s(e,o)}}function yn(n,t){return n===an?t:function(){return!1!==t.apply(this,arguments)&&n.apply(this,arguments)}}function pn(n,t){return n===an?t:function(){var r=n.apply(this,arguments);if(r&&"function"==typeof r.then){for(var e=this,i=arguments.length,u=new Array(i);i--;)u[i]=arguments[i];return r.then((function(){return t.apply(e,u)}))}return t.apply(this,arguments)}}fn.ModifyError=nn,fn.DexieError=X,fn.BulkError=tn;var wn={},mn="undefined"==typeof Promise?[]:function(){var n=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[n,l(n),n];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,l(t),n]}(),gn=mn[0],bn=mn[1],xn=mn[2],kn=bn&&bn.then,En=gn&&gn.constructor,An=!!xn,Pn=!1,jn=xn?function(){xn.then(zn)}:f.setImmediate?setImmediate.bind(null,zn):f.MutationObserver?function(){var n=document.createElement("div");new MutationObserver((function(){zn(),n=null})).observe(n,{attributes:!0}),n.setAttribute("i","1")}:function(){setTimeout(zn,0)},Sn=function(n,t){Mn.push([n,t]),On&&(jn(),On=!1)},In=!0,On=!0,Dn=[],Cn=[],Rn=null,Tn=cn,Kn={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:gt,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((function(n){try{gt(n[0],n[1])}catch(n){}}))}},Bn=Kn,Mn=[],qn=0,Nn=[];function Fn(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=an,this._lib=!1;var t=this._PSD=Bn;if(V&&(this._stackHolder=J(),this._prev=null,this._numPrev=0),"function"!=typeof n){if(n!==wn)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Vn(this,this._value))}this._state=null,this._value=null,++t.ref,Ln(this,n)}var Un={get:function(){var n=Bn,t=ut;function r(r,e){var i=this,u=!n.global&&(n!==Bn||t!==ut),o=u&&!ct(),f=new Fn((function(t,f){Wn(i,new _n(wt(r,n,u,o),wt(e,n,u,o),t,f,n))}));return V&&Yn(f,this),f}return r.prototype=wn,r},set:function(n){p(this,"then",n&&n.prototype===wn?Un:{get:function(){return n},set:Un.set})}};function _n(n,t,r,e,i){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof t?t:null,this.resolve=r,this.reject=e,this.psd=i}function Ln(n,t){try{t((function(t){if(null===n._state){if(t===n)throw new TypeError("A promise cannot be resolved with itself.");var r=n._lib&&Qn();t&&"function"==typeof t.then?Ln(n,(function(n,r){t instanceof Fn?t._then(n,r):t.then(n,r)})):(n._state=!0,n._value=t,Gn(n)),r&&$n()}}),Vn.bind(null,n))}catch(t){Vn(n,t)}}function Vn(n,t){if(Cn.push(t),null===n._state){var r=n._lib&&Qn();t=Tn(t),n._state=!1,n._value=t,V&&null!==t&&"object"==typeof t&&!t._promise&&function(){try{(function(){var r=g(t,"stack");t._promise=n,p(t,"stack",{get:function(){return Pn?r&&(r.get?r.get.apply(t):r.value):n.stack}})}).apply(null,void 0)}catch(n){}}(),function(n){Dn.some((function(t){return t._value===n._value}))||Dn.push(n)}(n),Gn(n),r&&$n()}}function Gn(n){var t=n._listeners;n._listeners=[];for(var r=0,e=t.length;r<e;++r)Wn(n,t[r]);var i=n._PSD;--i.ref||i.finalize(),0===qn&&(++qn,Sn((function(){0==--qn&&Xn()}),[]))}function Wn(n,t){if(null!==n._state){var r=n._state?t.onFulfilled:t.onRejected;if(null===r)return(n._state?t.resolve:t.reject)(n._value);++t.psd.ref,++qn,Sn(Hn,[r,n,t])}else n._listeners.push(t)}function Hn(n,t,r){try{Rn=t;var e,i=t._value;t._state?e=n(i):(Cn.length&&(Cn=[]),e=n(i),-1===Cn.indexOf(i)&&function(n){for(var t=Dn.length;t;)if(Dn[--t]._value===n._value)return void Dn.splice(t,1)}(t)),r.resolve(e)}catch(n){r.reject(n)}finally{Rn=null,0==--qn&&Xn(),--r.psd.ref||r.psd.finalize()}}function Jn(n,t,r){if(t.length===r)return t;var e="";if(!1===n._state){var i,u,o=n._value;null!=o?(i=o.name||"Error",u=o.message||o,e=Y(o,0)):(i=o,u=""),t.push(i+(u?": "+u:"")+e)}return V&&((e=Y(n._stackHolder,2))&&-1===t.indexOf(e)&&t.push(e),n._prev&&Jn(n._prev,t,r)),t}function Yn(n,t){var r=t?t._numPrev+1:0;r<100&&(n._prev=t,n._numPrev=r)}function zn(){Qn()&&$n()}function Qn(){var n=In;return In=!1,On=!1,n}function $n(){var n,t,r;do{for(;Mn.length>0;)for(n=Mn,Mn=[],r=n.length,t=0;t<r;++t){var e=n[t];e[0].apply(null,e[1])}}while(Mn.length>0);In=!0,On=!0}function Xn(){var n=Dn;Dn=[],n.forEach((function(n){n._PSD.onunhandled.call(null,n._value,n)}));for(var t=Nn.slice(0),r=t.length;r;)t[--r]()}function Zn(n){return new Fn(wn,!1,n)}function nt(n,t){var r=Bn;return function(){var e=Qn(),i=Bn;try{return vt(r,!0),n.apply(this,arguments)}catch(n){t&&t(n)}finally{vt(i,!1),e&&$n()}}}d(Fn.prototype,{then:Un,_then:function(n,t){Wn(this,new _n(null,null,n,t,Bn))},catch:function(n){if(1===arguments.length)return this.then(null,n);var t=arguments[0],r=arguments[1];return this.then(null,"function"==typeof t?function(n){return n instanceof t?r(n):Zn(n)}:function(n){return n&&n.name===t?r(n):Zn(n)})},finally:function(n){return this.then((function(t){return n(),t}),(function(t){return n(),Zn(t)}))},stack:{get:function(){if(this._stack)return this._stack;try{Pn=!0;var n=Jn(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=n),n}finally{Pn=!1}}},timeout:function(n,t){var r=this;return n<1/0?new Fn((function(e,i){var u=setTimeout((function(){return i(new un.Timeout(t))}),n);r.then(e,i).finally(clearTimeout.bind(null,u))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&p(Fn.prototype,Symbol.toStringTag,"Dexie.Promise"),Kn.env=dt(),d(Fn,{all:function(){var n=_.apply(null,arguments).map(st);return new Fn((function(t,r){0===n.length&&t([]);var e=n.length;n.forEach((function(i,u){return Fn.resolve(i).then((function(r){n[u]=r,--e||t(n)}),r)}))}))},resolve:function(n){if(n instanceof Fn)return n;if(n&&"function"==typeof n.then)return new Fn((function(t,r){n.then(t,r)}));var t=new Fn(wn,!0,n);return Yn(t,Rn),t},reject:Zn,race:function(){var n=_.apply(null,arguments).map(st);return new Fn((function(t,r){n.map((function(n){return Fn.resolve(n).then(t,r)}))}))},PSD:{get:function(){return Bn},set:function(n){return Bn=n}},totalEchoes:{get:function(){return ut}},newPSD:ft,usePSD:yt,scheduler:{get:function(){return Sn},set:function(n){Sn=n}},rejectionMapper:{get:function(){return Tn},set:function(n){Tn=n}},follow:function(n,t){return new Fn((function(r,e){return ft((function(t,r){var e=Bn;e.unhandleds=[],e.onunhandled=r,e.finalize=ln((function(){var n=this;Nn.push((function e(){0===n.unhandleds.length?t():r(n.unhandleds[0]),Nn.splice(Nn.indexOf(e),1)})),++qn,Sn((function(){0==--qn&&Xn()}),[])}),e.finalize),n()}),t,r,e)}))}}),En&&(En.allSettled&&p(Fn,"allSettled",(function(){var n=_.apply(null,arguments).map(st);return new Fn((function(t){0===n.length&&t([]);var r=n.length,e=new Array(r);n.forEach((function(n,i){return Fn.resolve(n).then((function(n){return e[i]={status:"fulfilled",value:n}}),(function(n){return e[i]={status:"rejected",reason:n}})).then((function(){return--r||t(e)}))}))}))})),En.any&&"undefined"!=typeof AggregateError&&p(Fn,"any",(function(){var n=_.apply(null,arguments).map(st);return new Fn((function(t,r){0===n.length&&r(new AggregateError([]));var e=n.length,i=new Array(e);n.forEach((function(n,u){return Fn.resolve(n).then((function(n){return t(n)}),(function(n){i[u]=n,--e||r(new AggregateError(i))}))}))}))})));var tt={awaits:0,echoes:0,id:0},rt=0,et=[],it=0,ut=0,ot=0;function ft(n,t,r,e){var i=Bn,u=Object.create(i);u.parent=i,u.ref=0,u.global=!1,u.id=++ot;var o=Kn.env;u.env=An?{Promise:Fn,PromiseProp:{value:Fn,configurable:!0,writable:!0},all:Fn.all,race:Fn.race,allSettled:Fn.allSettled,any:Fn.any,resolve:Fn.resolve,reject:Fn.reject,nthen:mt(o.nthen,u),gthen:mt(o.gthen,u)}:{},t&&s(u,t),++i.ref,u.finalize=function(){--this.parent.ref||this.parent.finalize()};var f=yt(u,n,r,e);return 0===u.ref&&u.finalize(),f}function at(){return tt.id||(tt.id=++rt),++tt.awaits,tt.echoes+=100,tt.id}function ct(){return!!tt.awaits&&(0==--tt.awaits&&(tt.id=0),tt.echoes=100*tt.awaits,!0)}function st(n){return tt.echoes&&n&&n.constructor===En?(at(),n.then((function(n){return ct(),n}),(function(n){return ct(),bt(n)}))):n}function lt(n){++ut,tt.echoes&&0!=--tt.echoes||(tt.echoes=tt.id=0),et.push(Bn),vt(n,!0)}function ht(){var n=et[et.length-1];et.pop(),vt(n,!1)}function vt(n,t){var r=Bn;if((t?!tt.echoes||it++&&n===Bn:!it||--it&&n===Bn)||pt(t?lt.bind(null,n):ht),n!==Bn&&(Bn=n,r===Kn&&(Kn.env=dt()),An)){var e=Kn.env.Promise,i=n.env;bn.then=i.nthen,e.prototype.then=i.gthen,(r.global||n.global)&&(Object.defineProperty(f,"Promise",i.PromiseProp),e.all=i.all,e.race=i.race,e.resolve=i.resolve,e.reject=i.reject,i.allSettled&&(e.allSettled=i.allSettled),i.any&&(e.any=i.any))}}function dt(){var n=f.Promise;return An?{Promise:n,PromiseProp:Object.getOwnPropertyDescriptor(f,"Promise"),all:n.all,race:n.race,allSettled:n.allSettled,any:n.any,resolve:n.resolve,reject:n.reject,nthen:bn.then,gthen:n.prototype.then}:{}}function yt(n,t,r,e,i){var u=Bn;try{return vt(n,!0),t(r,e,i)}finally{vt(u,!1)}}function pt(n){kn.call(gn,n)}function wt(n,t,r,e){return"function"!=typeof n?n:function(){var i=Bn;r&&at(),vt(t,!0);try{return n.apply(this,arguments)}finally{vt(i,!1),e&&pt(ct)}}}function mt(n,t){return function(r,e){return n.call(this,wt(r,t),wt(e,t))}}function gt(n,t){var r;try{r=t.onuncatched(n)}catch(n){}if(!1!==r)try{var e,i={promise:t,reason:n};if(f.document&&document.createEvent?((e=document.createEvent("Event")).initEvent("unhandledrejection",!0,!0),s(e,i)):f.CustomEvent&&s(e=new CustomEvent("unhandledrejection",{detail:i}),i),e&&f.dispatchEvent&&(dispatchEvent(e),!f.PromiseRejectionEvent&&f.onunhandledrejection))try{f.onunhandledrejection(e)}catch(n){}V&&e&&!e.defaultPrevented&&console.warn("Unhandled rejection: "+(n.stack||n))}catch(n){}}-1===(""+kn).indexOf("[native code]")&&(at=ct=an);var bt=Fn.reject;function xt(n,t,r,e){if(n.idbdb&&(n._state.openComplete||Bn.letThrough||n._vip)){var i=n._createTransaction(t,r,n._dbSchema);try{i.create(),n._state.PR1398_maxLoop=3}catch(i){return i.name===rn.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then((function(){return xt(n,t,r,e)}))):bt(i)}return i._promise(t,(function(n,t){return ft((function(){return Bn.trans=i,e(n,t,i)}))})).then((function(n){return i._completion.then((function(){return n}))}))}if(n._state.openComplete)return bt(new un.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen)return bt(new un.DatabaseClosed);n.open().catch(an)}return n._state.dbReadyPromise.then((function(){return xt(n,t,r,e)}))}var kt=String.fromCharCode(65535),Et="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",At=[],Pt="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),jt=Pt,St=Pt,It=function(n){return!/(dexie\.js|dexie\.min\.js)/.test(n)};function Ot(n,t){return n?t?function(){return n.apply(this,arguments)&&t.apply(this,arguments)}:n:t}var Dt={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ct(n){return"string"!=typeof n||/\./.test(n)?function(n){return n}:function(t){return void 0===t[n]&&n in t&&delete(t=K(t))[n],t}}var Rt=function(){function n(){}return n.prototype._trans=function(n,t,r){var e=this._tx||Bn.trans,i=this.name;function u(n,r,e){if(!e.schema[i])throw new un.NotFound("Table "+i+" not part of transaction");return t(e.idbtrans,e)}var o=Qn();try{return e&&e.db===this.db?e===Bn.trans?e._promise(n,u,r):ft((function(){return e._promise(n,u,r)}),{trans:e,transless:Bn.transless||Bn}):xt(this.db,n,[this.name],u)}finally{o&&$n()}},n.prototype.get=function(n,t){var r=this;return n&&n.constructor===Object?this.where(n).first(t):this._trans("readonly",(function(t){return r.core.get({trans:t,key:n}).then((function(n){return r.hook.reading.fire(n)}))})).then(t)},n.prototype.where=function(n){if("string"==typeof n)return new this.db.WhereClause(this,n);if(c(n))return new this.db.WhereClause(this,"["+n.join("+")+"]");var t=a(n);if(1===t.length)return this.where(t[0]).equals(n[t[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter((function(n){return n.compound&&t.every((function(t){return n.keyPath.indexOf(t)>=0}))&&n.keyPath.every((function(n){return t.indexOf(n)>=0}))}))[0];if(r&&this.db._maxKey!==kt)return this.where(r.name).equals(r.keyPath.map((function(t){return n[t]})));!r&&V&&console.warn("The query "+JSON.stringify(n)+" on "+this.name+" would benefit of a compound index ["+t.join("+")+"]");var e=this.schema.idxByName,i=this.db._deps.indexedDB;function u(n,t){try{return 0===i.cmp(n,t)}catch(n){return!1}}var o=t.reduce((function(t,r){var i=t[0],o=t[1],f=e[r],a=n[r];return[i||f,i||!f?Ot(o,f&&f.multi?function(n){var t=j(n,r);return c(t)&&t.some((function(n){return u(a,n)}))}:function(n){return u(a,j(n,r))}):o]}),[null,null]),f=o[0],s=o[1];return f?this.where(f.name).equals(n[f.keyPath]).filter(s):r?this.filter(s):this.where(t).equals("")},n.prototype.filter=function(n){return this.toCollection().and(n)},n.prototype.count=function(n){return this.toCollection().count(n)},n.prototype.offset=function(n){return this.toCollection().offset(n)},n.prototype.limit=function(n){return this.toCollection().limit(n)},n.prototype.each=function(n){return this.toCollection().each(n)},n.prototype.toArray=function(n){return this.toCollection().toArray(n)},n.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},n.prototype.orderBy=function(n){return new this.db.Collection(new this.db.WhereClause(this,c(n)?"["+n.join("+")+"]":n))},n.prototype.reverse=function(){return this.toCollection().reverse()},n.prototype.mapToClass=function(n){this.schema.mappedClass=n;var t=function(t){if(!t)return t;var r=Object.create(n.prototype);for(var e in t)if(v(t,e))try{r[e]=t[e]}catch(n){}return r};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),n},n.prototype.defineClass=function(){return this.mapToClass((function(n){s(this,n)}))},n.prototype.add=function(n,t){var r=this,e=this.schema.primKey,i=e.keyPath,u=n;return i&&e.auto&&(u=Ct(i)(n)),this._trans("readwrite",(function(n){return r.core.mutate({trans:n,type:"add",keys:null!=t?[t]:null,values:[u]})})).then((function(n){return n.numFailures?Fn.reject(n.failures[0]):n.lastResult})).then((function(t){if(i)try{S(n,i,t)}catch(n){}return t}))},n.prototype.update=function(n,t){if("object"!=typeof n||c(n))return this.where(":id").equals(n).modify(t);var r=j(n,this.schema.primKey.keyPath);if(void 0===r)return bt(new un.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof t?a(t).forEach((function(r){S(n,r,t[r])})):t(n,{value:n,primKey:r})}catch(n){}return this.where(":id").equals(r).modify(t)},n.prototype.put=function(n,t){var r=this,e=this.schema.primKey,i=e.keyPath,u=n;return i&&e.auto&&(u=Ct(i)(n)),this._trans("readwrite",(function(n){return r.core.mutate({trans:n,type:"put",values:[u],keys:null!=t?[t]:null})})).then((function(n){return n.numFailures?Fn.reject(n.failures[0]):n.lastResult})).then((function(t){if(i)try{S(n,i,t)}catch(n){}return t}))},n.prototype.delete=function(n){var t=this;return this._trans("readwrite",(function(r){return t.core.mutate({trans:r,type:"delete",keys:[n]})})).then((function(n){return n.numFailures?Fn.reject(n.failures[0]):void 0}))},n.prototype.clear=function(){var n=this;return this._trans("readwrite",(function(t){return n.core.mutate({trans:t,type:"deleteRange",range:Dt})})).then((function(n){return n.numFailures?Fn.reject(n.failures[0]):void 0}))},n.prototype.bulkGet=function(n){var t=this;return this._trans("readonly",(function(r){return t.core.getMany({keys:n,trans:r}).then((function(n){return n.map((function(n){return t.hook.reading.fire(n)}))}))}))},n.prototype.bulkAdd=function(n,t,r){var e=this,i=Array.isArray(t)?t:void 0,u=(r=r||(i?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",(function(t){var r=e.schema.primKey,o=r.auto,f=r.keyPath;if(f&&i)throw new un.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==n.length)throw new un.InvalidArgument("Arguments objects and keys must have the same length");var a=n.length,c=f&&o?n.map(Ct(f)):n;return e.core.mutate({trans:t,type:"add",keys:i,values:c,wantResults:u}).then((function(n){var t=n.numFailures;if(0===t)return u?n.results:n.lastResult;throw new tn(e.name+".bulkAdd(): "+t+" of "+a+" operations failed",n.failures)}))}))},n.prototype.bulkPut=function(n,t,r){var e=this,i=Array.isArray(t)?t:void 0,u=(r=r||(i?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",(function(t){var r=e.schema.primKey,o=r.auto,f=r.keyPath;if(f&&i)throw new un.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==n.length)throw new un.InvalidArgument("Arguments objects and keys must have the same length");var a=n.length,c=f&&o?n.map(Ct(f)):n;return e.core.mutate({trans:t,type:"put",keys:i,values:c,wantResults:u}).then((function(n){var t=n.numFailures;if(0===t)return u?n.results:n.lastResult;throw new tn(e.name+".bulkPut(): "+t+" of "+a+" operations failed",n.failures)}))}))},n.prototype.bulkDelete=function(n){var t=this,r=n.length;return this._trans("readwrite",(function(r){return t.core.mutate({trans:r,type:"delete",keys:n})})).then((function(n){var e=n.numFailures;if(0===e)return n.lastResult;throw new tn(t.name+".bulkDelete(): "+e+" of "+r+" operations failed",n.failures)}))},n}();function Tt(n){var t={},r=function(r,e){if(e){for(var i=arguments.length,u=new Array(i-1);--i;)u[i-1]=arguments[i];return t[r].subscribe.apply(null,u),n}if("string"==typeof r)return t[r]};r.addEventType=u;for(var e=1,i=arguments.length;e<i;++e)u(arguments[e]);return r;function u(n,e,i){if("object"==typeof n)return o(n);e||(e=yn),i||(i=an);var u={subscribers:[],fire:i,subscribe:function(n){-1===u.subscribers.indexOf(n)&&(u.subscribers.push(n),u.fire=e(u.fire,n))},unsubscribe:function(n){u.subscribers=u.subscribers.filter((function(t){return t!==n})),u.fire=u.subscribers.reduce(e,i)}};return t[n]=r[n]=u,u}function o(n){a(n).forEach((function(t){var r=n[t];if(c(r))u(t,n[t][0],n[t][1]);else{if("asap"!==r)throw new un.InvalidArgument("Invalid event config");var e=u(t,cn,(function(){for(var n=arguments.length,t=new Array(n);n--;)t[n]=arguments[n];e.subscribers.forEach((function(n){A((function(){n.apply(null,t)}))}))}))}}))}}function Kt(n,t){return w(t).from({prototype:n}),t}function Bt(n,t){return!(n.filter||n.algorithm||n.or)&&(t?n.justLimit:!n.replayFilter)}function Mt(n,t){n.filter=Ot(n.filter,t)}function qt(n,t,r){var e=n.replayFilter;n.replayFilter=e?function(){return Ot(e(),t())}:t,n.justLimit=r&&!e}function Nt(n,t){if(n.isPrimKey)return t.primaryKey;var r=t.getIndexByKeyPath(n.index);if(!r)throw new un.Schema("KeyPath "+n.index+" on object store "+t.name+" is not indexed");return r}function Ft(n,t,r){var e=Nt(n,t.schema);return t.openCursor({trans:r,values:!n.keysOnly,reverse:"prev"===n.dir,unique:!!n.unique,query:{index:e,range:n.range}})}function Ut(n,t,r,e){var i=n.replayFilter?Ot(n.filter,n.replayFilter()):n.filter;if(n.or){var u={},o=function(n,r,e){if(!i||i(r,e,(function(n){return r.stop(n)}),(function(n){return r.fail(n)}))){var o=r.primaryKey,f=""+o;"[object ArrayBuffer]"===f&&(f=""+new Uint8Array(o)),v(u,f)||(u[f]=!0,t(n,r,e))}};return Promise.all([n.or._iterate(o,r),_t(Ft(n,e,r),n.algorithm,o,!n.keysOnly&&n.valueMapper)])}return _t(Ft(n,e,r),Ot(n.algorithm,i),t,!n.keysOnly&&n.valueMapper)}function _t(n,t,r,e){var i=nt(e?function(n,t,i){return r(e(n),t,i)}:r);return n.then((function(n){if(n)return n.start((function(){var r=function(){return n.continue()};t&&!t(n,(function(n){return r=n}),(function(t){n.stop(t),r=an}),(function(t){n.fail(t),r=an}))||i(n.value,n,(function(n){return r=n})),r()}))}))}function Lt(n,t){try{var r=Vt(n),e=Vt(t);if(r!==e)return"Array"===r?1:"Array"===e?-1:"binary"===r?1:"binary"===e?-1:"string"===r?1:"string"===e?-1:"Date"===r?1:"Date"!==e?NaN:-1;switch(r){case"number":case"Date":case"string":return n>t?1:n<t?-1:0;case"binary":return function(n,t){for(var r=n.length,e=t.length,i=r<e?r:e,u=0;u<i;++u)if(n[u]!==t[u])return n[u]<t[u]?-1:1;return r===e?0:r<e?-1:1}(Gt(n),Gt(t));case"Array":return function(n,t){for(var r=n.length,e=t.length,i=r<e?r:e,u=0;u<i;++u){var o=Lt(n[u],t[u]);if(0!==o)return o}return r===e?0:r<e?-1:1}(n,t)}}catch(n){}return NaN}function Vt(n){var t=typeof n;if("object"!==t)return t;if(ArrayBuffer.isView(n))return"binary";var r=q(n);return"ArrayBuffer"===r?"binary":r}function Gt(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n)}var Wt=function(){function n(){}return n.prototype._read=function(n,t){var r=this._ctx;return r.error?r.table._trans(null,bt.bind(null,r.error)):r.table._trans("readonly",n).then(t)},n.prototype._write=function(n){var t=this._ctx;return t.error?t.table._trans(null,bt.bind(null,t.error)):t.table._trans("readwrite",n,"locked")},n.prototype._addAlgorithm=function(n){var t=this._ctx;t.algorithm=Ot(t.algorithm,n)},n.prototype._iterate=function(n,t){return Ut(this._ctx,n,t,this._ctx.table.core)},n.prototype.clone=function(n){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return n&&s(r,n),t._ctx=r,t},n.prototype.raw=function(){return this._ctx.valueMapper=null,this},n.prototype.each=function(n){var t=this._ctx;return this._read((function(r){return Ut(t,n,r,t.table.core)}))},n.prototype.count=function(n){var t=this;return this._read((function(n){var r=t._ctx,e=r.table.core;if(Bt(r,!0))return e.count({trans:n,query:{index:Nt(r,e.schema),range:r.range}}).then((function(n){return Math.min(n,r.limit)}));var i=0;return Ut(r,(function(){return++i,!1}),n,e).then((function(){return i}))})).then(n)},n.prototype.sortBy=function(n,t){var r=n.split(".").reverse(),e=r[0],i=r.length-1;function u(n,t){return t?u(n[r[t]],t-1):n[e]}var o="next"===this._ctx.dir?1:-1;function f(n,t){var r=u(n,i),e=u(t,i);return r<e?-o:r>e?o:0}return this.toArray((function(n){return n.sort(f)})).then(t)},n.prototype.toArray=function(n){var t=this;return this._read((function(n){var r=t._ctx;if("next"===r.dir&&Bt(r,!0)&&r.limit>0){var e=r.valueMapper,i=Nt(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:i,range:r.range}}).then((function(n){var t=n.result;return e?t.map(e):t}))}var u=[];return Ut(r,(function(n){return u.push(n)}),n,r.table.core).then((function(){return u}))}),n)},n.prototype.offset=function(n){var t=this._ctx;return n<=0||(t.offset+=n,Bt(t)?qt(t,(function(){var t=n;return function(n,r){return 0===t||(1===t?(--t,!1):(r((function(){n.advance(t),t=0})),!1))}})):qt(t,(function(){var t=n;return function(){return--t<0}}))),this},n.prototype.limit=function(n){return this._ctx.limit=Math.min(this._ctx.limit,n),qt(this._ctx,(function(){var t=n;return function(n,r,e){return--t<=0&&r(e),t>=0}}),!0),this},n.prototype.until=function(n,t){return Mt(this._ctx,(function(r,e,i){return!n(r.value)||(e(i),t)})),this},n.prototype.first=function(n){return this.limit(1).toArray((function(n){return n[0]})).then(n)},n.prototype.last=function(n){return this.reverse().first(n)},n.prototype.filter=function(n){var t;return Mt(this._ctx,(function(t){return n(t.value)})),(t=this._ctx).isMatch=Ot(t.isMatch,n),this},n.prototype.and=function(n){return this.filter(n)},n.prototype.or=function(n){return new this.db.WhereClause(this._ctx.table,n,this)},n.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},n.prototype.desc=function(){return this.reverse()},n.prototype.eachKey=function(n){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,r){n(r.key,r)}))},n.prototype.eachUniqueKey=function(n){return this._ctx.unique="unique",this.eachKey(n)},n.prototype.eachPrimaryKey=function(n){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,r){n(r.primaryKey,r)}))},n.prototype.keys=function(n){var t=this._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each((function(n,t){r.push(t.key)})).then((function(){return r})).then(n)},n.prototype.primaryKeys=function(n){var t=this._ctx;if("next"===t.dir&&Bt(t,!0)&&t.limit>0)return this._read((function(n){var r=Nt(t,t.table.core.schema);return t.table.core.query({trans:n,values:!1,limit:t.limit,query:{index:r,range:t.range}})})).then((function(n){return n.result})).then(n);t.keysOnly=!t.isMatch;var r=[];return this.each((function(n,t){r.push(t.primaryKey)})).then((function(){return r})).then(n)},n.prototype.uniqueKeys=function(n){return this._ctx.unique="unique",this.keys(n)},n.prototype.firstKey=function(n){return this.limit(1).keys((function(n){return n[0]})).then(n)},n.prototype.lastKey=function(n){return this.reverse().firstKey(n)},n.prototype.distinct=function(){var n=this._ctx,t=n.index&&n.table.schema.idxByName[n.index];if(!t||!t.multi)return this;var r={};return Mt(this._ctx,(function(n){var t=n.primaryKey.toString(),e=v(r,t);return r[t]=!0,!e})),this},n.prototype.modify=function(n){var t=this,r=this._ctx;return this._write((function(e){var i;if("function"==typeof n)i=n;else{var u=a(n),o=u.length;i=function(t){for(var r=!1,e=0;e<o;++e){var i=u[e],f=n[i];j(t,i)!==f&&(S(t,i,f),r=!0)}return r}}var f=r.table.core,c=f.schema.primaryKey,s=c.outbound,l=c.extractKey,h=t.db._options.modifyChunkSize||200,v=[],d=0,y=[],p=function(n,t){var r=t.failures;d+=n-t.numFailures;for(var e=0,i=a(r);e<i.length;e++)v.push(r[i[e]])};return t.clone().primaryKeys().then((function(t){var u=function(o){var a=Math.min(h,t.length-o);return f.getMany({trans:e,keys:t.slice(o,o+a),cache:"immutable"}).then((function(c){for(var v=[],d=[],y=s?[]:null,w=[],m=0;m<a;++m){var g=c[m],b={value:K(g),primKey:t[o+m]};!1!==i.call(b,b.value,b)&&(null==b.value?w.push(t[o+m]):s||0===Lt(l(g),l(b.value))?(d.push(b.value),s&&y.push(t[o+m])):(w.push(t[o+m]),v.push(b.value)))}var x=Bt(r)&&r.limit===1/0&&("function"!=typeof n||n===Ht)&&{index:r.index,range:r.range};return Promise.resolve(v.length>0&&f.mutate({trans:e,type:"add",values:v}).then((function(n){for(var t in n.failures)w.splice(parseInt(t),1);p(v.length,n)}))).then((function(){return(d.length>0||x&&"object"==typeof n)&&f.mutate({trans:e,type:"put",keys:y,values:d,criteria:x,changeSpec:"function"!=typeof n&&n}).then((function(n){return p(d.length,n)}))})).then((function(){return(w.length>0||x&&n===Ht)&&f.mutate({trans:e,type:"delete",keys:w,criteria:x}).then((function(n){return p(w.length,n)}))})).then((function(){return t.length>o+a&&u(o+h)}))}))};return u(0).then((function(){if(v.length>0)throw new nn("Error modifying one or more objects",v,d,y);return t.length}))}))}))},n.prototype.delete=function(){var n=this._ctx,t=n.range;return Bt(n)&&(n.isPrimKey&&!St||3===t.type)?this._write((function(r){var e=t;return n.table.core.count({trans:r,query:{index:n.table.core.schema.primaryKey,range:e}}).then((function(t){return n.table.core.mutate({trans:r,type:"deleteRange",range:e}).then((function(n){var r=n.failures,e=n.numFailures;if(e)throw new nn("Could not delete some values",Object.keys(r).map((function(n){return r[n]})),t-e);return t-e}))}))})):this.modify(Ht)},n}(),Ht=function(n,t){return t.value=null};function Jt(n,t){return n<t?-1:n===t?0:1}function Yt(n,t){return n>t?-1:n===t?0:1}function zt(n,t,r){var e=n instanceof tr?new n.Collection(n):n;return e._ctx.error=r?new r(t):new TypeError(t),e}function Qt(n){return new n.Collection(n,(function(){return nr("")})).limit(0)}function $t(n,t,r,e,i,u){for(var o=Math.min(n.length,e.length),f=-1,a=0;a<o;++a){var c=t[a];if(c!==e[a])return i(n[a],r[a])<0?n.substr(0,a)+r[a]+r.substr(a+1):i(n[a],e[a])<0?n.substr(0,a)+e[a]+r.substr(a+1):f>=0?n.substr(0,f)+t[f]+r.substr(f+1):null;i(n[a],c)<0&&(f=a)}return o<e.length&&"next"===u?n+r.substr(n.length):o<n.length&&"prev"===u?n.substr(0,r.length):f<0?null:n.substr(0,f)+e[f]+r.substr(f+1)}function Xt(n,t,r,e){var i,u,o,f,a,c,s,l=r.length;if(!r.every((function(n){return"string"==typeof n})))return zt(n,"String expected.");function h(n){i=function(n){return"next"===n?function(n){return n.toUpperCase()}:function(n){return n.toLowerCase()}}(n),u=function(n){return"next"===n?function(n){return n.toLowerCase()}:function(n){return n.toUpperCase()}}(n),o="next"===n?Jt:Yt;var t=r.map((function(n){return{lower:u(n),upper:i(n)}})).sort((function(n,t){return o(n.lower,t.lower)}));f=t.map((function(n){return n.upper})),a=t.map((function(n){return n.lower})),c=n,s="next"===n?"":e}h("next");var v=new n.Collection(n,(function(){return Zt(f[0],a[l-1]+e)}));v._ondirectionchange=function(n){h(n)};var d=0;return v._addAlgorithm((function(n,r,e){var i=n.key;if("string"!=typeof i)return!1;var h=u(i);if(t(h,a,d))return!0;for(var v=null,y=d;y<l;++y){var p=$t(i,h,f[y],a[y],o,c);null===p&&null===v?d=y+1:(null===v||o(v,p)>0)&&(v=p)}return r(null!==v?function(){n.continue(v+s)}:e),!1})),v}function Zt(n,t,r,e){return{type:2,lower:n,upper:t,lowerOpen:r,upperOpen:e}}function nr(n){return{type:1,lower:n,upper:n}}var tr=function(){function n(){}return Object.defineProperty(n.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),n.prototype.between=function(n,t,r,e){r=!1!==r,e=!0===e;try{return this._cmp(n,t)>0||0===this._cmp(n,t)&&(r||e)&&(!r||!e)?Qt(this):new this.Collection(this,(function(){return Zt(n,t,!r,!e)}))}catch(n){return zt(this,Et)}},n.prototype.equals=function(n){return null==n?zt(this,Et):new this.Collection(this,(function(){return nr(n)}))},n.prototype.above=function(n){return null==n?zt(this,Et):new this.Collection(this,(function(){return Zt(n,void 0,!0)}))},n.prototype.aboveOrEqual=function(n){return null==n?zt(this,Et):new this.Collection(this,(function(){return Zt(n,void 0,!1)}))},n.prototype.below=function(n){return null==n?zt(this,Et):new this.Collection(this,(function(){return Zt(void 0,n,!1,!0)}))},n.prototype.belowOrEqual=function(n){return null==n?zt(this,Et):new this.Collection(this,(function(){return Zt(void 0,n)}))},n.prototype.startsWith=function(n){return"string"!=typeof n?zt(this,"String expected."):this.between(n,n+kt,!0,!0)},n.prototype.startsWithIgnoreCase=function(n){return""===n?this.startsWith(n):Xt(this,(function(n,t){return 0===n.indexOf(t[0])}),[n],kt)},n.prototype.equalsIgnoreCase=function(n){return Xt(this,(function(n,t){return n===t[0]}),[n],"")},n.prototype.anyOfIgnoreCase=function(){var n=_.apply(U,arguments);return 0===n.length?Qt(this):Xt(this,(function(n,t){return-1!==t.indexOf(n)}),n,"")},n.prototype.startsWithAnyOfIgnoreCase=function(){var n=_.apply(U,arguments);return 0===n.length?Qt(this):Xt(this,(function(n,t){return t.some((function(t){return 0===n.indexOf(t)}))}),n,kt)},n.prototype.anyOf=function(){var n=this,t=_.apply(U,arguments),r=this._cmp;try{t.sort(r)}catch(n){return zt(this,Et)}if(0===t.length)return Qt(this);var e=new this.Collection(this,(function(){return Zt(t[0],t[t.length-1])}));e._ondirectionchange=function(e){t.sort(r="next"===e?n._ascending:n._descending)};var i=0;return e._addAlgorithm((function(n,e,u){for(var o=n.key;r(o,t[i])>0;)if(++i===t.length)return e(u),!1;return 0===r(o,t[i])||(e((function(){n.continue(t[i])})),!1)})),e},n.prototype.notEqual=function(n){return this.inAnyRange([[-1/0,n],[n,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},n.prototype.noneOf=function(){var n=_.apply(U,arguments);if(0===n.length)return new this.Collection(this);try{n.sort(this._ascending)}catch(n){return zt(this,Et)}var t=n.reduce((function(n,t){return n?n.concat([[n[n.length-1][1],t]]):[[-1/0,t]]}),null);return t.push([n[n.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},n.prototype.inAnyRange=function(n,t){var r=this,e=this._cmp,i=this._ascending,u=this._descending,o=this._min,f=this._max;if(0===n.length)return Qt(this);if(!n.every((function(n){return void 0!==n[0]&&void 0!==n[1]&&i(n[0],n[1])<=0})))return zt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",un.InvalidArgument);var a,c=!t||!1!==t.includeLowers,s=t&&!0===t.includeUppers,l=i;function h(n,t){return l(n[0],t[0])}try{(a=n.reduce((function(n,t){for(var r=0,i=n.length;r<i;++r){var u=n[r];if(e(t[0],u[1])<0&&e(t[1],u[0])>0){u[0]=o(u[0],t[0]),u[1]=f(u[1],t[1]);break}}return r===i&&n.push(t),n}),[])).sort(h)}catch(n){return zt(this,Et)}var v=0,d=s?function(n){return i(n,a[v][1])>0}:function(n){return i(n,a[v][1])>=0},y=c?function(n){return u(n,a[v][0])>0}:function(n){return u(n,a[v][0])>=0},p=d,w=new this.Collection(this,(function(){return Zt(a[0][0],a[a.length-1][1],!c,!s)}));return w._ondirectionchange=function(n){"next"===n?(p=d,l=i):(p=y,l=u),a.sort(h)},w._addAlgorithm((function(n,t,e){for(var u=n.key;p(u);)if(++v===a.length)return t(e),!1;return!!function(n){return!d(n)&&!y(n)}(u)||(0===r._cmp(u,a[v][1])||0===r._cmp(u,a[v][0])||t((function(){n.continue(l===i?a[v][0]:a[v][1])})),!1)})),w},n.prototype.startsWithAnyOf=function(){var n=_.apply(U,arguments);return n.every((function(n){return"string"==typeof n}))?0===n.length?Qt(this):this.inAnyRange(n.map((function(n){return[n,n+kt]}))):zt(this,"startsWithAnyOf() only works with strings")},n}();function rr(n){return nt((function(t){return er(t),n(t.target.error),!1}))}function er(n){n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault()}var ir=Tt(null,"storagemutated"),ur=function(){function n(){}return n.prototype._lock=function(){return E(!Bn.global),++this._reculock,1!==this._reculock||Bn.global||(Bn.lockOwnerFor=this),this},n.prototype._unlock=function(){if(E(!Bn.global),0==--this._reculock)for(Bn.global||(Bn.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var n=this._blockedFuncs.shift();try{yt(n[1],n[0])}catch(n){}}return this},n.prototype._locked=function(){return this._reculock&&Bn.lockOwnerFor!==this},n.prototype.create=function(n){var t=this;if(!this.mode)return this;var r=this.db.idbdb,e=this.db._state.dbOpenError;if(E(!this.idbtrans),!n&&!r)switch(e&&e.name){case"DatabaseClosedError":throw new un.DatabaseClosed(e);case"MissingAPIError":throw new un.MissingAPI(e.message,e);default:throw new un.OpenFailed(e)}if(!this.active)throw new un.TransactionInactive;return E(null===this._completion._state),(n=this.idbtrans=n||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=nt((function(r){er(r),t._reject(n.error)})),n.onabort=nt((function(r){er(r),t.active&&t._reject(new un.Abort(n.error)),t.active=!1,t.on("abort").fire(r)})),n.oncomplete=nt((function(){t.active=!1,t._resolve(),"mutatedParts"in n&&ir.storagemutated.fire(n.mutatedParts)})),this},n.prototype._promise=function(n,t,r){var e=this;if("readwrite"===n&&"readwrite"!==this.mode)return bt(new un.ReadOnly("Transaction is readonly"));if(!this.active)return bt(new un.TransactionInactive);if(this._locked())return new Fn((function(i,u){e._blockedFuncs.push([function(){e._promise(n,t,r).then(i,u)},Bn])}));if(r)return ft((function(){var n=new Fn((function(n,r){e._lock();var i=t(n,r,e);i&&i.then&&i.then(n,r)}));return n.finally((function(){return e._unlock()})),n._lib=!0,n}));var i=new Fn((function(n,r){var i=t(n,r,e);i&&i.then&&i.then(n,r)}));return i._lib=!0,i},n.prototype._root=function(){return this.parent?this.parent._root():this},n.prototype.waitFor=function(n){var t=this._root(),r=Fn.resolve(n);if(t._waitingFor)t._waitingFor=t._waitingFor.then((function(){return r}));else{t._waitingFor=r,t._waitingQueue=[];var e=t.idbtrans.objectStore(t.storeNames[0]);!function n(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(e.get(-1/0).onsuccess=n)}()}var i=t._waitingFor;return new Fn((function(n,e){r.then((function(r){return t._waitingQueue.push(nt(n.bind(null,r)))}),(function(n){return t._waitingQueue.push(nt(e.bind(null,n)))})).finally((function(){t._waitingFor===i&&(t._waitingFor=null)}))}))},n.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new un.Abort))},n.prototype.table=function(n){var t=this._memoizedTables||(this._memoizedTables={});if(v(t,n))return t[n];var r=this.schema[n];if(!r)throw new un.NotFound("Table "+n+" not part of transaction");var e=new this.db.Table(n,r,this);return e.core=this.db.core.table(n),t[n]=e,e},n}();function or(n,t,r,e,i,u,o){return{name:n,keyPath:t,unique:r,multi:e,auto:i,compound:u,src:(r&&!o?"&":"")+(e?"*":"")+(i?"++":"")+fr(t)}}function fr(n){return"string"==typeof n?n:n?"["+[].join.call(n,"+")+"]":""}function ar(n,t,r){return{name:n,primKey:t,indexes:r,mappedClass:null,idxByName:P(r,(function(n){return[n.name,n]}))}}var cr=function(n){try{return n.only([[]]),cr=function(){return[[]]},[[]]}catch(n){return cr=function(){return kt},kt}};function sr(n){return null==n?function(){}:"string"==typeof n?function(n){return 1===n.split(".").length?function(t){return t[n]}:function(t){return j(t,n)}}(n):function(t){return j(t,n)}}function lr(n){return[].slice.call(n)}var hr=0;function vr(n){return null==n?":id":"string"==typeof n?n:"["+n.join("+")+"]"}function dr(n,t,r){function e(n){if(3===n.type)return null;if(4===n.type)throw new Error("Cannot convert never type to IDBKeyRange");var r=n.lower,e=n.upper,i=n.lowerOpen,u=n.upperOpen;return void 0===r?void 0===e?null:t.upperBound(e,!!u):void 0===e?t.lowerBound(r,!!i):t.bound(r,e,!!i,!!u)}var i=function(n,t){var r=lr(n.objectStoreNames);return{schema:{name:n.name,tables:r.map((function(n){return t.objectStore(n)})).map((function(n){var t=n.keyPath,r=n.autoIncrement,e=c(t),i={},u={name:n.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:null==t,compound:e,keyPath:t,autoIncrement:r,unique:!0,extractKey:sr(t)},indexes:lr(n.indexNames).map((function(t){return n.index(t)})).map((function(n){var t=n.unique,r=n.multiEntry,e=n.keyPath,u={name:n.name,compound:c(e),keyPath:e,unique:t,multiEntry:r,extractKey:sr(e)};return i[vr(e)]=u,u})),getIndexByKeyPath:function(n){return i[vr(n)]}};return i[":id"]=u.primaryKey,null!=t&&(i[vr(t)]=u.primaryKey),u}))},hasGetAll:r.length>0&&"getAll"in t.objectStore(r[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(n,r),u=i.schema,o=i.hasGetAll,f=u.tables.map((function(n){return function(n){var t=n.name;return{name:t,schema:n,mutate:function(n){var r=n.trans,i=n.type,u=n.keys,o=n.values,f=n.range;return new Promise((function(n){n=nt(n);var a=r.objectStore(t),c=null==a.keyPath,s="put"===i||"add"===i;if(!s&&"delete"!==i&&"deleteRange"!==i)throw new Error("Invalid operation type: "+i);var l,h=(u||o||{length:1}).length;if(u&&o&&u.length!==o.length)throw new Error("Given keys array must have same length as given values array.");if(0===h)return n({numFailures:0,failures:{},results:[],lastResult:void 0});var v=[],d=[],y=0,p=function(n){++y,er(n)};if("deleteRange"===i){if(4===f.type)return n({numFailures:y,failures:d,results:[],lastResult:void 0});v.push(l=3===f.type?a.clear():a.delete(e(f)))}else{var w=s?c?[o,u]:[o,null]:[u,null],m=w[0],g=w[1];if(s)for(var b=0;b<h;++b)v.push(l=g&&void 0!==g[b]?a[i](m[b],g[b]):a[i](m[b])),l.onerror=p;else for(b=0;b<h;++b)v.push(l=a[i](m[b])),l.onerror=p}var x=function(t){var r=t.target.result;v.forEach((function(n,t){return null!=n.error&&(d[t]=n.error)})),n({numFailures:y,failures:d,results:"delete"===i?u:v.map((function(n){return n.result})),lastResult:r})};l.onerror=function(n){p(n),x(n)},l.onsuccess=x}))},getMany:function(n){var r=n.trans,e=n.keys;return new Promise((function(n,i){n=nt(n);for(var u,o=r.objectStore(t),f=e.length,a=new Array(f),c=0,s=0,l=function(t){var r=t.target;a[r._pos]=r.result,++s===c&&n(a)},h=rr(i),v=0;v<f;++v)null!=e[v]&&((u=o.get(e[v]))._pos=v,u.onsuccess=l,u.onerror=h,++c);0===c&&n(a)}))},get:function(n){var r=n.trans,e=n.key;return new Promise((function(n,i){n=nt(n);var u=r.objectStore(t).get(e);u.onsuccess=function(t){return n(t.target.result)},u.onerror=rr(i)}))},query:function(n){return function(r){return new Promise((function(i,u){i=nt(i);var o=r.values,f=r.limit,a=r.query,c=f===1/0?void 0:f,s=a.index,l=a.range,h=r.trans.objectStore(t),v=s.isPrimaryKey?h:h.index(s.name),d=e(l);if(0===f)return i({result:[]});if(n){var y=o?v.getAll(d,c):v.getAllKeys(d,c);y.onsuccess=function(n){return i({result:n.target.result})},y.onerror=rr(u)}else{var p=0,w=o||!("openKeyCursor"in v)?v.openCursor(d):v.openKeyCursor(d),m=[];w.onsuccess=function(){var n=w.result;return n?(m.push(o?n.value:n.primaryKey),++p===f?i({result:m}):void n.continue()):i({result:m})},w.onerror=rr(u)}}))}}(o),openCursor:function(n){var r=n.trans,i=n.values,u=n.query,o=n.reverse,f=n.unique;return new Promise((function(n,a){n=nt(n);var c=u.index,s=u.range,l=r.objectStore(t),h=c.isPrimaryKey?l:l.index(c.name),v=o?f?"prevunique":"prev":f?"nextunique":"next",d=i||!("openKeyCursor"in h)?h.openCursor(e(s),v):h.openKeyCursor(e(s),v);d.onerror=rr(a),d.onsuccess=nt((function(){var t=d.result;if(t){t.___id=++hr,t.done=!1;var e=t.continue.bind(t),i=t.continuePrimaryKey;i&&(i=i.bind(t));var u=t.advance.bind(t),o=function(){throw new Error("Cursor not stopped")};t.trans=r,t.stop=t.continue=t.continuePrimaryKey=t.advance=function(){throw new Error("Cursor not started")},t.fail=nt(a),t.next=function(){var n=this,t=1;return this.start((function(){return t--?n.continue():n.stop()})).then((function(){return n}))},t.start=function(n){var r=new Promise((function(n,r){n=nt(n),d.onerror=rr(r),t.fail=r,t.stop=function(r){t.stop=t.continue=t.continuePrimaryKey=t.advance=o,n(r)}})),f=function(){if(d.result)try{n()}catch(n){t.fail(n)}else t.done=!0,t.start=function(){throw new Error("Cursor behind last entry")},t.stop()};return d.onsuccess=nt((function(){d.onsuccess=f,f()})),t.continue=e,t.continuePrimaryKey=i,t.advance=u,f(),r},n(t)}else n(null)}),a)}))},count:function(n){var r=n.query,i=n.trans,u=r.index,o=r.range;return new Promise((function(n,r){var f=i.objectStore(t),a=u.isPrimaryKey?f:f.index(u.name),c=e(o),s=c?a.count(c):a.count();s.onsuccess=nt((function(t){return n(t.target.result)})),s.onerror=rr(r)}))}}}(n)})),a={};return f.forEach((function(n){return a[n.name]=n})),{stack:"dbcore",transaction:n.transaction.bind(n),table:function(n){if(!a[n])throw new Error("Table '"+n+"' not found");return a[n]},MIN_KEY:-1/0,MAX_KEY:cr(t),schema:u}}function yr(n,t){var r=n._novip,e=function(n,t,r,e){return{dbcore:function(n,t){return t.reduce((function(n,t){var r=t.create;return u(u({},n),r(n))}),n)}(dr(t,r.IDBKeyRange,e),n.dbcore)}}(r._middlewares,t.db,r._deps,t);r.core=e.dbcore,r.tables.forEach((function(n){var t=n.name;r.core.schema.tables.some((function(n){return n.name===t}))&&(n.core=r.core.table(t),r[t]instanceof r.Table&&(r[t].core=n.core))}))}function pr(n,t,r,e){var i=n._novip;r.forEach((function(n){var r=e[n];t.forEach((function(t){var e=g(t,n);(!e||"value"in e&&void 0===e.value)&&(t===i.Transaction.prototype||t instanceof i.Transaction?p(t,n,{get:function(){return this.table(n)},set:function(t){y(this,n,{value:t,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new i.Table(n,r))}))}))}function wr(n,t){var r=n._novip;t.forEach((function(n){for(var t in n)n[t]instanceof r.Table&&delete n[t]}))}function mr(n,t){return n._cfg.version-t._cfg.version}function gr(n,t){var r,e={del:[],add:[],change:[]};for(r in n)t[r]||e.del.push(r);for(r in t){var i=n[r],u=t[r];if(i){var o={name:r,def:u,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(u.primKey.keyPath||"")||i.primKey.auto!==u.primKey.auto&&!Pt)o.recreate=!0,e.change.push(o);else{var f=i.idxByName,a=u.idxByName,c=void 0;for(c in f)a[c]||o.del.push(c);for(c in a){var s=f[c],l=a[c];s?s.src!==l.src&&o.change.push(l):o.add.push(l)}(o.del.length>0||o.add.length>0||o.change.length>0)&&e.change.push(o)}}else e.add.push([r,u])}return e}function br(n,t,r,e){var i=n.db.createObjectStore(t,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return e.forEach((function(n){return xr(i,n)})),i}function xr(n,t){n.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function kr(n,t,r){var e={};return x(t.objectStoreNames,0).forEach((function(n){for(var t=r.objectStore(n),i=t.keyPath,u=or(fr(i),i||"",!1,!1,!!t.autoIncrement,i&&"string"!=typeof i,!0),o=[],f=0;f<t.indexNames.length;++f){var a=t.index(t.indexNames[f]),c=or(a.name,i=a.keyPath,!!a.unique,!!a.multiEntry,!1,i&&"string"!=typeof i,!1);o.push(c)}e[n]=ar(n,u,o)})),e}function Er(n,t,r){for(var e=n._novip,i=r.db.objectStoreNames,u=0;u<i.length;++u){var o=i[u],a=r.objectStore(o);e._hasGetAll="getAll"in a;for(var c=0;c<a.indexNames.length;++c){var s=a.indexNames[c],l=a.index(s).keyPath,h="string"==typeof l?l:"["+x(l).join("+")+"]";if(t[o]){var v=t[o].idxByName[h];v&&(v.name=s,delete t[o].idxByName[h],t[o].idxByName[s]=v)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&f.WorkerGlobalScope&&f instanceof f.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}var Ar=function(){function n(){}return n.prototype._parseStoresSpec=function(n,t){a(n).forEach((function(r){if(null!==n[r]){var e=n[r].split(",").map((function(n,t){var r=(n=n.trim()).replace(/([&*]|\+\+)/g,""),e=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return or(r,e||null,/\&/.test(n),/\*/.test(n),/\+\+/.test(n),c(e),0===t)})),i=e.shift();if(i.multi)throw new un.Schema("Primary key cannot be multi-valued");e.forEach((function(n){if(n.auto)throw new un.Schema("Only primary key can be marked as autoIncrement (++)");if(!n.keyPath)throw new un.Schema("Index must have a name and cannot be an empty string")})),t[r]=ar(r,i,e)}}))},n.prototype.stores=function(n){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?s(this._cfg.storesSource,n):n;var r={},e={};return t._versions.forEach((function(n){s(r,n._cfg.storesSource),e=n._cfg.dbschema={},n._parseStoresSpec(r,e)})),t._dbSchema=e,wr(t,[t._allTables,t,t.Transaction.prototype]),pr(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],a(e),e),t._storeNames=a(e),this},n.prototype.upgrade=function(n){return this._cfg.contentUpgrade=pn(this._cfg.contentUpgrade||an,n),this},n}();function Pr(n,t){var r=n._dbNamesDB;return r||(r=n._dbNamesDB=new Qr("__dbnames",{addons:[],indexedDB:n,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),r.table("dbnames")}function jr(n){return n&&"function"==typeof n.databases}function Sr(n,t){var r=n.indexedDB,e=n.IDBKeyRange;!jr(r)&&"__dbnames"!==t&&Pr(r,e).delete(t).catch(an)}function Ir(n){return ft((function(){return Bn.letThrough=!0,n()}))}function Or(){var n;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(t){var r=function(){return indexedDB.databases().finally(t)};n=setInterval(r,100),r()})).finally((function(){return clearInterval(n)})):Promise.resolve()}function Dr(n){var t=n._state,r=n._deps.indexedDB;if(t.isBeingOpened||n.idbdb)return t.dbReadyPromise.then((function(){return t.dbOpenError?bt(t.dbOpenError):n}));V&&(t.openCanceller._stackHolder=J()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var e=t.openCanceller;function i(){if(t.openCanceller!==e)throw new un.DatabaseClosed("db.open() was cancelled")}var u=t.dbReadyResolve,o=null,f=!1;return Fn.race([e,("undefined"==typeof navigator?Fn.resolve():Or()).then((function(){return new Fn((function(e,u){if(i(),!r)throw new un.MissingAPI;var c=n.name,s=t.autoSchema?r.open(c):r.open(c,Math.round(10*n.verno));if(!s)throw new un.MissingAPI;s.onerror=rr(u),s.onblocked=nt(n._fireOnBlocked),s.onupgradeneeded=nt((function(e){if(o=s.transaction,t.autoSchema&&!n._options.allowEmptyDB){s.onerror=er,o.abort(),s.result.close();var i=r.deleteDatabase(c);i.onsuccess=i.onerror=nt((function(){u(new un.NoSuchDatabase("Database "+c+" doesnt exist"))}))}else{o.onerror=rr(u);var l=e.oldVersion>Math.pow(2,62)?0:e.oldVersion;f=l<1,n._novip.idbdb=s.result,function(n,t,r,e){var i=n._dbSchema,u=n._createTransaction("readwrite",n._storeNames,i);u.create(r),u._completion.catch(e);var o=u._reject.bind(u),f=Bn.transless||Bn;ft((function(){Bn.trans=u,Bn.transless=f,0===t?(a(i).forEach((function(n){br(r,n,i[n].primKey,i[n].indexes)})),yr(n,r),Fn.follow((function(){return n.on.populate.fire(u)})).catch(o)):function(n,t,r,e){var i=n._novip,u=[],o=i._versions,f=i._dbSchema=kr(0,i.idbdb,e),c=!1;return o.filter((function(n){return n._cfg.version>=t})).forEach((function(n){u.push((function(){var u=f,o=n._cfg.dbschema;Er(i,u,e),Er(i,o,e),f=i._dbSchema=o;var s=gr(u,o);s.add.forEach((function(n){br(e,n[0],n[1].primKey,n[1].indexes)})),s.change.forEach((function(n){if(n.recreate)throw new un.Upgrade("Not yet support for changing primary key");var t=e.objectStore(n.name);n.add.forEach((function(n){return xr(t,n)})),n.change.forEach((function(n){t.deleteIndex(n.name),xr(t,n)})),n.del.forEach((function(n){return t.deleteIndex(n)}))}));var l=n._cfg.contentUpgrade;if(l&&n._cfg.version>t){yr(i,e),r._memoizedTables={},c=!0;var h=I(o);s.del.forEach((function(n){h[n]=u[n]})),wr(i,[i.Transaction.prototype]),pr(i,[i.Transaction.prototype],a(h),h),r.schema=h;var v,d=L(l);d&&at();var y=Fn.follow((function(){if((v=l(r))&&d){var n=ct.bind(null,null);v.then(n,n)}}));return v&&"function"==typeof v.then?Fn.resolve(v):y.then((function(){return v}))}})),u.push((function(t){c&&jt||function(n,t){[].slice.call(t.db.objectStoreNames).forEach((function(r){return null==n[r]&&t.db.deleteObjectStore(r)}))}(n._cfg.dbschema,t),wr(i,[i.Transaction.prototype]),pr(i,[i.Transaction.prototype],i._storeNames,i._dbSchema),r.schema=i._dbSchema}))})),function n(){return u.length?Fn.resolve(u.shift()(r.idbtrans)).then(n):Fn.resolve()}().then((function(){var n,t;t=e,a(n=f).forEach((function(r){t.db.objectStoreNames.contains(r)||br(t,r,n[r].primKey,n[r].indexes)}))}))}(n,t,u,r).catch(o)}))}(n,l/10,o,u)}}),u),s.onsuccess=nt((function(){o=null;var r,i=n._novip.idbdb=s.result,u=x(i.objectStoreNames);if(u.length>0)try{var l=i.transaction(1===(r=u).length?r[0]:r,"readonly");t.autoSchema?function(n,t,r){var e=n._novip;e.verno=t.version/10;var i=e._dbSchema=kr(0,t,r);e._storeNames=x(t.objectStoreNames,0),pr(e,[e._allTables],a(i),i)}(n,i,l):(Er(n,n._dbSchema,l),function(n,t){var r=gr(kr(0,n.idbdb,t),n._dbSchema);return!(r.add.length||r.change.some((function(n){return n.add.length||n.change.length})))}(n,l)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),yr(n,l)}catch(n){}At.push(n),i.onversionchange=nt((function(r){t.vcFired=!0,n.on("versionchange").fire(r)})),i.onclose=nt((function(t){n.on("close").fire(t)})),f&&function(n,t){var r=n.indexedDB,e=n.IDBKeyRange;!jr(r)&&"__dbnames"!==t&&Pr(r,e).put({name:t}).catch(an)}(n._deps,c),e()}),u)}))}))]).then((function(){return i(),t.onReadyBeingFired=[],Fn.resolve(Ir((function(){return n.on.ready.fire(n.vip)}))).then((function r(){if(t.onReadyBeingFired.length>0){var e=t.onReadyBeingFired.reduce(pn,an);return t.onReadyBeingFired=[],Fn.resolve(Ir((function(){return e(n.vip)}))).then(r)}}))})).finally((function(){t.onReadyBeingFired=null,t.isBeingOpened=!1})).then((function(){return n})).catch((function(r){t.dbOpenError=r;try{o&&o.abort()}catch(n){}return e===t.openCanceller&&n._close(),bt(r)})).finally((function(){t.openComplete=!0,u()}))}function Cr(n){var t=function(t){return n.next(t)},r=i(t),e=i((function(t){return n.throw(t)}));function i(n){return function(t){var i=n(t),u=i.value;return i.done?u:u&&"function"==typeof u.then?u.then(r,e):c(u)?Promise.all(u).then(r,e):r(u)}}return i(t)()}function Rr(n,t,r){var e=arguments.length;if(e<2)throw new un.InvalidArgument("Too few arguments");for(var i=new Array(e-1);--e;)i[e-1]=arguments[e];r=i.pop();var u=D(i);return[n,u,r]}function Tr(n,t,r,e,i){return Fn.resolve().then((function(){var u=Bn.transless||Bn,o=n._createTransaction(t,r,n._dbSchema,e),f={trans:o,transless:u};if(e)o.idbtrans=e.idbtrans;else try{o.create(),n._state.PR1398_maxLoop=3}catch(e){return e.name===rn.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then((function(){return Tr(n,t,r,null,i)}))):bt(e)}var a,c=L(i);c&&at();var s=Fn.follow((function(){if(a=i.call(o,o))if(c){var n=ct.bind(null,null);a.then(n,n)}else"function"==typeof a.next&&"function"==typeof a.throw&&(a=Cr(a))}),f);return(a&&"function"==typeof a.then?Fn.resolve(a).then((function(n){return o.active?n:bt(new un.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))})):s.then((function(){return a}))).then((function(n){return e&&o._resolve(),o._completion.then((function(){return n}))})).catch((function(n){return o._reject(n),bt(n)}))}))}function Kr(n,t,r){for(var e=c(n)?n.slice():[n],i=0;i<r;++i)e.push(t);return e}var Br={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(n){return u(u({},n),{table:function(t){var r=n.table(t),e=r.schema,i={},o=[];function f(n,t,r){var e=vr(n),a=i[e]=i[e]||[],c=null==n?0:"string"==typeof n?1:n.length,s=t>0,l=u(u({},r),{isVirtual:s,keyTail:t,keyLength:c,extractKey:sr(n),unique:!s&&r.unique});return a.push(l),l.isPrimaryKey||o.push(l),c>1&&f(2===c?n[0]:n.slice(0,c-1),t+1,r),a.sort((function(n,t){return n.keyTail-t.keyTail})),l}var a=f(e.primaryKey.keyPath,0,e.primaryKey);i[":id"]=[a];for(var c=0,s=e.indexes;c<s.length;c++){var l=s[c];f(l.keyPath,0,l)}function h(t){var r,e,i=t.query.index;return i.isVirtual?u(u({},t),{query:{index:i,range:(r=t.query.range,e=i.keyTail,{type:1===r.type?2:r.type,lower:Kr(r.lower,r.lowerOpen?n.MAX_KEY:n.MIN_KEY,e),lowerOpen:!0,upper:Kr(r.upper,r.upperOpen?n.MIN_KEY:n.MAX_KEY,e),upperOpen:!0})}}):t}return u(u({},r),{schema:u(u({},e),{primaryKey:a,indexes:o,getIndexByKeyPath:function(n){var t=i[vr(n)];return t&&t[0]}}),count:function(n){return r.count(h(n))},query:function(n){return r.query(h(n))},openCursor:function(t){var e=t.query.index,i=e.keyTail,u=e.keyLength;return e.isVirtual?r.openCursor(h(t)).then((function(r){return r&&function(r){return Object.create(r,{continue:{value:function(e){null!=e?r.continue(Kr(e,t.reverse?n.MAX_KEY:n.MIN_KEY,i)):t.unique?r.continue(r.key.slice(0,u).concat(t.reverse?n.MIN_KEY:n.MAX_KEY,i)):r.continue()}},continuePrimaryKey:{value:function(t,e){r.continuePrimaryKey(Kr(t,n.MAX_KEY,i),e)}},primaryKey:{get:function(){return r.primaryKey}},key:{get:function(){var n=r.key;return 1===u?n[0]:n.slice(0,u)}},value:{get:function(){return r.value}}})}(r)})):r.openCursor(t)}})}})}};function Mr(n,t,r,e){return r=r||{},e=e||"",a(n).forEach((function(i){if(v(t,i)){var u=n[i],o=t[i];if("object"==typeof u&&"object"==typeof o&&u&&o){var f=q(u);f!==q(o)?r[e+i]=t[i]:"Object"===f?Mr(u,o,r,e+i+"."):u!==o&&(r[e+i]=t[i])}else u!==o&&(r[e+i]=t[i])}else r[e+i]=void 0})),a(t).forEach((function(i){v(n,i)||(r[e+i]=t[i])})),r}var qr={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(n){return u(u({},n),{table:function(t){var r=n.table(t),e=r.schema.primaryKey;return u(u({},r),{mutate:function(n){var i=Bn.trans,f=i.table(t).hook,a=f.deleting,c=f.creating,s=f.updating;switch(n.type){case"add":if(c.fire===an)break;return i._promise("readwrite",(function(){return l(n)}),!0);case"put":if(c.fire===an&&s.fire===an)break;return i._promise("readwrite",(function(){return l(n)}),!0);case"delete":if(a.fire===an)break;return i._promise("readwrite",(function(){return l(n)}),!0);case"deleteRange":if(a.fire===an)break;return i._promise("readwrite",(function(){return function(n){return h(n.trans,n.range,1e4)}(n)}),!0)}return r.mutate(n);function l(n){var t=Bn.trans,i=n.keys||function(n,t){return"delete"===t.type?t.keys:t.keys||t.values.map(n.extractKey)}(e,n);if(!i)throw new Error("Keys missing");return"delete"!==(n="add"===n.type||"put"===n.type?u(u({},n),{keys:i}):u({},n)).type&&(n.values=o([],n.values,!0)),n.keys&&(n.keys=o([],n.keys,!0)),function(n,t,r){return"add"===t.type?Promise.resolve([]):n.getMany({trans:t.trans,keys:r,cache:"immutable"})}(r,n,i).then((function(u){var o=i.map((function(r,i){var o=u[i],f={onerror:null,onsuccess:null};if("delete"===n.type)a.fire.call(f,r,o,t);else if("add"===n.type||void 0===o){var l=c.fire.call(f,r,n.values[i],t);null==r&&null!=l&&(n.keys[i]=r=l,e.outbound||S(n.values[i],e.keyPath,r))}else{var h=Mr(o,n.values[i]),d=s.fire.call(f,h,r,o,t);if(d){var y=n.values[i];Object.keys(d).forEach((function(n){v(y,n)?y[n]=d[n]:S(y,n,d[n])}))}}return f}));return r.mutate(n).then((function(t){for(var r=t.failures,e=t.results,f=t.numFailures,a=t.lastResult,c=0;c<i.length;++c){var s=e?e[c]:i[c],l=o[c];null==s?l.onerror&&l.onerror(r[c]):l.onsuccess&&l.onsuccess("put"===n.type&&u[c]?n.values[c]:s)}return{failures:r,results:e,numFailures:f,lastResult:a}})).catch((function(n){return o.forEach((function(t){return t.onerror&&t.onerror(n)})),Promise.reject(n)}))}))}function h(n,t,i){return r.query({trans:n,values:!1,query:{index:e,range:t},limit:i}).then((function(r){var e=r.result;return l({type:"delete",keys:e,trans:n}).then((function(r){return r.numFailures>0?Promise.reject(r.failures[0]):e.length<i?{failures:[],numFailures:0,lastResult:void 0}:h(n,u(u({},t),{lower:e[e.length-1],lowerOpen:!0}),i)}))}))}}})}})}};function Nr(n,t,r){try{if(!t)return null;if(t.keys.length<n.length)return null;for(var e=[],i=0,u=0;i<t.keys.length&&u<n.length;++i)0===Lt(t.keys[i],n[u])&&(e.push(r?K(t.values[i]):t.values[i]),++u);return e.length===n.length?e:null}catch(n){return null}}var Fr,Ur={stack:"dbcore",level:-1,create:function(n){return{table:function(t){var r=n.table(t);return u(u({},r),{getMany:function(n){if(!n.cache)return r.getMany(n);var t=Nr(n.keys,n.trans._cache,"clone"===n.cache);return t?Fn.resolve(t):r.getMany(n).then((function(t){return n.trans._cache={keys:n.keys,values:"clone"===n.cache?K(t):t},t}))},mutate:function(n){return"add"!==n.type&&(n.trans._cache=null),r.mutate(n)}})}}}};function _r(n){return!("from"in n)}var Lr=function(n,t){if(!this){var r=new Lr;return n&&"d"in n&&s(r,n),r}s(this,arguments.length?{d:1,from:n,to:arguments.length>1?t:n}:{d:0})};function Vr(n,t,r){var e=Lt(t,r);if(!isNaN(e)){if(e>0)throw RangeError();if(_r(n))return s(n,{from:t,to:r,d:1});var i=n.l,u=n.r;if(Lt(r,n.from)<0)return i?Vr(i,t,r):n.l={from:t,to:r,d:1,l:null,r:null},Hr(n);if(Lt(t,n.to)>0)return u?Vr(u,t,r):n.r={from:t,to:r,d:1,l:null,r:null},Hr(n);Lt(t,n.from)<0&&(n.from=t,n.l=null,n.d=u?u.d+1:1),Lt(r,n.to)>0&&(n.to=r,n.r=null,n.d=n.l?n.l.d+1:1);var o=!n.r;i&&!n.l&&Gr(n,i),u&&o&&Gr(n,u)}}function Gr(n,t){_r(t)||function n(t,r){var e=r.l,i=r.r;Vr(t,r.from,r.to),e&&n(t,e),i&&n(t,i)}(n,t)}function Wr(n){var t=_r(n)?null:{s:0,n};return{next:function(n){for(var r=arguments.length>0;t;)switch(t.s){case 0:if(t.s=1,r)for(;t.n.l&&Lt(n,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!r||Lt(n,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Hr(n){var t,r,e=((null===(t=n.r)||void 0===t?void 0:t.d)||0)-((null===(r=n.l)||void 0===r?void 0:r.d)||0),i=e>1?"r":e<-1?"l":"";if(i){var o="r"===i?"l":"r",f=u({},n),a=n[i];n.from=a.from,n.to=a.to,n[i]=a[i],f[i]=a[o],n[o]=f,f.d=Jr(f)}n.d=Jr(n)}function Jr(n){var t=n.r,r=n.l;return(t?r?Math.max(t.d,r.d):t.d:r?r.d:0)+1}d(Lr.prototype,((Fr={add:function(n){return Gr(this,n),this},addKey:function(n){return Vr(this,n,n),this},addKeys:function(n){var t=this;return n.forEach((function(n){return Vr(t,n,n)})),this}})[N]=function(){return Wr(this)},Fr));var Yr,zr={stack:"dbcore",level:0,create:function(n){var t=n.schema.name,r=new Lr(n.MIN_KEY,n.MAX_KEY);return u(u({},n),{table:function(e){var i=n.table(e),o=i.schema,f=o.primaryKey,s=f.extractKey,l=f.outbound,h=u(u({},i),{mutate:function(n){var u=n.trans,f=u.mutatedParts||(u.mutatedParts={}),a=function(n){var r="idb://"+t+"/"+e+"/"+n;return f[r]||(f[r]=new Lr)},s=a(""),l=a(":dels"),h=n.type,v="deleteRange"===n.type?[n.range]:"delete"===n.type?[n.keys]:n.values.length<50?[[],n.values]:[],d=v[0],y=v[1],p=n.trans._cache;return i.mutate(n).then((function(n){if(c(d)){"delete"!==h&&(d=n.results),s.addKeys(d);var t=Nr(d,p);t||"add"===h||l.addKeys(d),(t||y)&&function(n,t,r,e){t.indexes.forEach((function(t){var i=n(t.name||"");function u(n){return null!=n?t.extractKey(n):null}var o=function(n){return t.multiEntry&&c(n)?n.forEach((function(n){return i.addKey(n)})):i.addKey(n)};(r||e).forEach((function(n,t){var i=r&&u(r[t]),f=e&&u(e[t]);0!==Lt(i,f)&&(null!=i&&o(i),null!=f&&o(f))}))}))}(a,o,t,y)}else if(d){var e={from:d.lower,to:d.upper};l.add(e),s.add(e)}else s.add(r),l.add(r),o.indexes.forEach((function(n){return a(n.name).add(r)}));return n}))}}),v=function(t){var r,e,i=t.query,u=i.range;return[i.index,new Lr(null!==(r=u.lower)&&void 0!==r?r:n.MIN_KEY,null!==(e=u.upper)&&void 0!==e?e:n.MAX_KEY)]},d={get:function(n){return[f,new Lr(n.key)]},getMany:function(n){return[f,(new Lr).addKeys(n.keys)]},count:v,query:v,openCursor:v};return a(d).forEach((function(n){h[n]=function(o){var f=Bn.subscr;if(f){var a=function(n){var r="idb://"+t+"/"+e+"/"+n;return f[r]||(f[r]=new Lr)},c=a(""),h=a(":dels"),v=d[n](o),y=v[0],p=v[1];if(a(y.name||"").add(p),!y.isPrimaryKey){if("count"!==n){var w="query"===n&&l&&o.values&&i.query(u(u({},o),{values:!1}));return i[n].apply(this,arguments).then((function(t){if("query"===n){if(l&&o.values)return w.then((function(n){return c.addKeys(n.result),t}));var r=o.values?t.result.map(s):t.result;o.values?c.addKeys(r):h.addKeys(r)}else if("openCursor"===n){var e=t,i=o.values;return e&&Object.create(e,{key:{get:function(){return h.addKey(e.primaryKey),e.key}},primaryKey:{get:function(){var n=e.primaryKey;return h.addKey(n),n}},value:{get:function(){return i&&c.addKey(e.primaryKey),e.value}}})}return t}))}h.add(r)}}return i[n].apply(this,arguments)}})),h}})}},Qr=function(){function n(t,r){var e=this;this._middlewares={},this.verno=0;var i=n.dependencies;this._options=r=u({addons:n.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},r),this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange};var o=r.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var f,a={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:an,dbReadyPromise:null,cancelOpen:an,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};a.dbReadyPromise=new Fn((function(n){a.dbReadyResolve=n})),a.openCanceller=new Fn((function(n,t){a.cancelOpen=t})),this._state=a,this.name=t,this.on=Tt(this,"populate","blocked","versionchange","close",{ready:[pn,an]}),this.on.ready.subscribe=k(this.on.ready.subscribe,(function(t){return function(r,i){n.vip((function(){var n=e._state;if(n.openComplete)n.dbOpenError||Fn.resolve().then(r),i&&t(r);else if(n.onReadyBeingFired)n.onReadyBeingFired.push(r),i&&t(r);else{t(r);var u=e;i||t((function n(){u.on.ready.unsubscribe(r),u.on.ready.unsubscribe(n)}))}}))}})),this.Collection=(f=this,Kt(Wt.prototype,(function(n,t){this.db=f;var r=Dt,e=null;if(t)try{r=t()}catch(n){e=n}var i=n._ctx,u=i.table,o=u.hook.reading.fire;this._ctx={table:u,index:i.index,isPrimKey:!i.index||u.schema.primKey.keyPath&&i.index===u.schema.primKey.name,range:r,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:e,or:i.or,valueMapper:o!==cn?o:null}}))),this.Table=function(n){return Kt(Rt.prototype,(function(t,r,e){this.db=n,this._tx=e,this.name=t,this.schema=r,this.hook=n._allTables[t]?n._allTables[t].hook:Tt(null,{creating:[hn,an],reading:[sn,cn],updating:[dn,an],deleting:[vn,an]})}))}(this),this.Transaction=function(n){return Kt(ur.prototype,(function(t,r,e,i,u){var o=this;this.db=n,this.mode=t,this.storeNames=r,this.schema=e,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=Tt(this,"complete","error","abort"),this.parent=u||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Fn((function(n,t){o._resolve=n,o._reject=t})),this._completion.then((function(){o.active=!1,o.on.complete.fire()}),(function(n){var t=o.active;return o.active=!1,o.on.error.fire(n),o.parent?o.parent._reject(n):t&&o.idbtrans&&o.idbtrans.abort(),bt(n)}))}))}(this),this.Version=function(n){return Kt(Ar.prototype,(function(t){this.db=n,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(n){return Kt(tr.prototype,(function(t,r,e){this.db=n,this._ctx={table:t,index:":id"===r?null:r,or:e};var i=n._deps.indexedDB;if(!i)throw new un.MissingAPI;this._cmp=this._ascending=i.cmp.bind(i),this._descending=function(n,t){return i.cmp(t,n)},this._max=function(n,t){return i.cmp(n,t)>0?n:t},this._min=function(n,t){return i.cmp(n,t)<0?n:t},this._IDBKeyRange=n._deps.IDBKeyRange}))}(this),this.on("versionchange",(function(n){n.newVersion>0?console.warn("Another connection wants to upgrade database '"+e.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+e.name+"'. Closing db now to resume the delete request."),e.close()})),this.on("blocked",(function(n){!n.newVersion||n.newVersion<n.oldVersion?console.warn("Dexie.delete('"+e.name+"') was blocked"):console.warn("Upgrade '"+e.name+"' blocked by other connection holding version "+n.oldVersion/10)})),this._maxKey=cr(r.IDBKeyRange),this._createTransaction=function(n,t,r,i){return new e.Transaction(n,t,r,e._options.chromeTransactionDurability,i)},this._fireOnBlocked=function(n){e.on("blocked").fire(n),At.filter((function(n){return n.name===e.name&&n!==e&&!n._state.vcFired})).map((function(t){return t.on("versionchange").fire(n)}))},this.use(Br),this.use(qr),this.use(zr),this.use(Ur),this.vip=Object.create(this,{_vip:{value:!0}}),o.forEach((function(n){return n(e)}))}return n.prototype.version=function(n){if(isNaN(n)||n<.1)throw new un.Type("Given version is not a positive number");if(n=Math.round(10*n)/10,this.idbdb||this._state.isBeingOpened)throw new un.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,n);var t=this._versions,r=t.filter((function(t){return t._cfg.version===n}))[0];return r||(r=new this.Version(n),t.push(r),t.sort(mr),r.stores({}),this._state.autoSchema=!1,r)},n.prototype._whenReady=function(n){var t=this;return this.idbdb&&(this._state.openComplete||Bn.letThrough||this._vip)?n():new Fn((function(n,r){if(t._state.openComplete)return r(new un.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return void r(new un.DatabaseClosed);t.open().catch(an)}t._state.dbReadyPromise.then(n,r)})).then(n)},n.prototype.use=function(n){var t=n.stack,r=n.create,e=n.level,i=n.name;i&&this.unuse({stack:t,name:i});var u=this._middlewares[t]||(this._middlewares[t]=[]);return u.push({stack:t,create:r,level:null==e?10:e,name:i}),u.sort((function(n,t){return n.level-t.level})),this},n.prototype.unuse=function(n){var t=n.stack,r=n.name,e=n.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter((function(n){return e?n.create!==e:!!r&&n.name!==r}))),this},n.prototype.open=function(){return Dr(this)},n.prototype._close=function(){var n=this._state,t=At.indexOf(this);if(t>=0&&At.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(n){}this._novip.idbdb=null}n.dbReadyPromise=new Fn((function(t){n.dbReadyResolve=t})),n.openCanceller=new Fn((function(t,r){n.cancelOpen=r}))},n.prototype.close=function(){this._close();var n=this._state;this._options.autoOpen=!1,n.dbOpenError=new un.DatabaseClosed,n.isBeingOpened&&n.cancelOpen(n.dbOpenError)},n.prototype.delete=function(){var n=this,t=arguments.length>0,r=this._state;return new Fn((function(e,i){var u=function(){n.close();var t=n._deps.indexedDB.deleteDatabase(n.name);t.onsuccess=nt((function(){Sr(n._deps,n.name),e()})),t.onerror=rr(i),t.onblocked=n._fireOnBlocked};if(t)throw new un.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(u):u()}))},n.prototype.backendDB=function(){return this.idbdb},n.prototype.isOpen=function(){return null!==this.idbdb},n.prototype.hasBeenClosed=function(){var n=this._state.dbOpenError;return n&&"DatabaseClosed"===n.name},n.prototype.hasFailed=function(){return null!==this._state.dbOpenError},n.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(n.prototype,"tables",{get:function(){var n=this;return a(this._allTables).map((function(t){return n._allTables[t]}))},enumerable:!1,configurable:!0}),n.prototype.transaction=function(){var n=Rr.apply(this,arguments);return this._transaction.apply(this,n)},n.prototype._transaction=function(n,t,r){var e=this,i=Bn.trans;i&&i.db===this&&-1===n.indexOf("!")||(i=null);var u,o,f=-1!==n.indexOf("?");n=n.replace("!","").replace("?","");try{if(o=t.map((function(n){var t=n instanceof e.Table?n.name:n;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==n||"readonly"===n)u="readonly";else{if("rw"!=n&&"readwrite"!=n)throw new un.InvalidArgument("Invalid transaction mode: "+n);u="readwrite"}if(i){if("readonly"===i.mode&&"readwrite"===u){if(!f)throw new un.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&o.forEach((function(n){if(i&&-1===i.storeNames.indexOf(n)){if(!f)throw new un.SubTransaction("Table "+n+" not included in parent transaction.");i=null}})),f&&i&&!i.active&&(i=null)}}catch(n){return i?i._promise(null,(function(t,r){r(n)})):bt(n)}var a=Tr.bind(null,this,u,o,i,r);return i?i._promise(u,a,"lock"):Bn.trans?yt(Bn.transless,(function(){return e._whenReady(a)})):this._whenReady(a)},n.prototype.table=function(n){if(!v(this._allTables,n))throw new un.InvalidTable("Table "+n+" does not exist");return this._allTables[n]},n}(),$r="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable",Xr=function(){function n(n){this._subscribe=n}return n.prototype.subscribe=function(n,t,r){return this._subscribe(n&&"function"!=typeof n?n:{next:n,error:t,complete:r})},n.prototype[$r]=function(){return this},n}();function Zr(n,t){return a(t).forEach((function(r){Gr(n[r]||(n[r]=new Lr),t[r])})),n}try{Yr={indexedDB:f.indexedDB||f.mozIndexedDB||f.webkitIndexedDB||f.msIndexedDB,IDBKeyRange:f.IDBKeyRange||f.webkitIDBKeyRange}}catch(n){Yr={indexedDB:null,IDBKeyRange:null}}var ne=Qr;function te(n){var t=re;try{re=!0,ir.storagemutated.fire(n)}finally{re=t}}d(ne,u(u({},fn),{delete:function(n){return new ne(n,{addons:[]}).delete()},exists:function(n){return new ne(n,{addons:[]}).open().then((function(n){return n.close(),!0})).catch("NoSuchDatabaseError",(function(){return!1}))},getDatabaseNames:function(n){try{return function(n){var t=n.indexedDB,r=n.IDBKeyRange;return jr(t)?Promise.resolve(t.databases()).then((function(n){return n.map((function(n){return n.name})).filter((function(n){return"__dbnames"!==n}))})):Pr(t,r).toCollection().primaryKeys()}(ne.dependencies).then(n)}catch(n){return bt(new un.MissingAPI)}},defineClass:function(){return function(n){s(this,n)}},ignoreTransaction:function(n){return Bn.trans?yt(Bn.transless,n):n()},vip:Ir,async:function(n){return function(){try{var t=Cr(n.apply(this,arguments));return t&&"function"==typeof t.then?t:Fn.resolve(t)}catch(n){return bt(n)}}},spawn:function(n,t,r){try{var e=Cr(n.apply(r,t||[]));return e&&"function"==typeof e.then?e:Fn.resolve(e)}catch(n){return bt(n)}},currentTransaction:{get:function(){return Bn.trans||null}},waitFor:function(n,t){var r=Fn.resolve("function"==typeof n?ne.ignoreTransaction(n):n).timeout(t||6e4);return Bn.trans?Bn.trans.waitFor(r):r},Promise:Fn,debug:{get:function(){return V},set:function(n){G(n,"dexie"===n?function(){return!0}:It)}},derive:w,extend:s,props:d,override:k,Events:Tt,on:ir,liveQuery:function(n){return new Xr((function(t){var r=L(n),e=!1,i={},u={},o={get closed(){return e},unsubscribe:function(){e=!0,ir.storagemutated.unsubscribe(l)}};t.start&&t.start(o);var f=!1,c=!1;function s(){return a(u).some((function(n){return i[n]&&function(n,t){var r=Wr(t),e=r.next();if(e.done)return!1;for(var i=e.value,u=Wr(n),o=u.next(i.from),f=o.value;!e.done&&!o.done;){if(Lt(f.from,i.to)<=0&&Lt(f.to,i.from)>=0)return!0;Lt(i.from,f.from)<0?i=(e=r.next(f.from)).value:f=(o=u.next(i.from)).value}return!1}(i[n],u[n])}))}var l=function(n){Zr(i,n),s()&&h()},h=function(){if(!f&&!e){i={};var a={},v=function(t){r&&at();var e=function(){return ft(n,{subscr:t,trans:null})},i=Bn.trans?yt(Bn.transless,e):e();return r&&i.then(ct,ct),i}(a);c||(ir("storagemutated",l),c=!0),f=!0,Promise.resolve(v).then((function(n){f=!1,e||(s()?h():(i={},u=a,t.next&&t.next(n)))}),(function(n){f=!1,t.error&&t.error(n),o.unsubscribe()}))}};return h(),o}))},extendObservabilitySet:Zr,getByKeyPath:j,setByKeyPath:S,delByKeyPath:function(n,t){"string"==typeof t?S(n,t,void 0):"length"in t&&[].map.call(t,(function(t){S(n,t,void 0)}))},shallowClone:I,deepClone:K,getObjectDiff:Mr,cmp:Lt,asap:A,minKey:-1/0,addons:[],connections:At,errnames:rn,dependencies:Yr,semVer:"3.2.3",version:"3.2.3".split(".").map((function(n){return parseInt(n)})).reduce((function(n,t,r){return n+t/Math.pow(10,2*r)}))})),ne.maxKey=cr(ne.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(ir("storagemutated",(function(n){var t;re||(Pt?(t=document.createEvent("CustomEvent")).initCustomEvent("x-storagemutated-1",!0,!0,n):t=new CustomEvent("x-storagemutated-1",{detail:n}),re=!0,dispatchEvent(t),re=!1)})),addEventListener("x-storagemutated-1",(function(n){re||te(n.detail)})));var re=!1;if("undefined"!=typeof BroadcastChannel){var ee=new BroadcastChannel("x-storagemutated-1");"function"==typeof ee.unref&&ee.unref(),ir("storagemutated",(function(n){re||ee.postMessage(n)})),ee.onmessage=function(n){n.data&&te(n.data)}}else if("undefined"!=typeof self&&"undefined"!=typeof navigator){ir("storagemutated",(function(n){try{re||("undefined"!=typeof localStorage&&localStorage.setItem("x-storagemutated-1",JSON.stringify({trig:Math.random(),changedParts:n})),"object"==typeof self.clients&&o([],self.clients.matchAll({includeUncontrolled:!0}),!0).forEach((function(t){return t.postMessage({type:"x-storagemutated-1",changedParts:n})})))}catch(n){}})),"undefined"!=typeof addEventListener&&addEventListener("storage",(function(n){if("x-storagemutated-1"===n.key){var t=JSON.parse(n.newValue);t&&te(t.changedParts)}}));var ie=self.document&&navigator.serviceWorker;ie&&ie.addEventListener("message",(function(n){var t=n.data;t&&"x-storagemutated-1"===t.type&&te(t.changedParts)}))}Fn.rejectionMapper=function(n,t){if(!n||n instanceof X||n instanceof TypeError||n instanceof SyntaxError||!n.name||!on[n.name])return n;var r=new on[n.name](t||n.message,n);return"stack"in n&&p(r,"stack",{get:function(){return this.inner.stack}}),r},G(V,It);class ue{constructor(n){this.playlists=n}upsert(t){return n((async()=>{await this.playlists.put(t)}))}query({name:t}){return n((()=>this.playlists.where("name").equals(t).toArray()))}}class oe{constructor(n){this.playlistItems=n}upsert(t){return n((async()=>{await this.playlistItems.put(t)}))}delete(t){return n((async()=>{await this.playlistItems.delete([t.playlistId,t.videoId])}))}query({playlistId:t}){return n((()=>this.playlistItems.where("playlistId").equals(t).toArray()))}}class fe extends Qr{constructor(){super("myDatabase"),this.version(2).stores({playlists:"++id, name",playlistItems:"[playlistId+videoId]"})}static getInstance(){return r(new fe)}getRepo(n){if("playlists"===n)return new ue(this.playlists);if("playlistsItems"===n)return new oe(this.playlistItems);throw new Error(`Repo not defined for table name: ${n}`)}}function ae(){return fe.getInstance()}function ce(){return ae().pipe(e((n=>n.getRepo("playlists").upsert(i).pipe(t((()=>n))))))}export{ae as g,ce as i}