import{h as s}from"./p-27ce4408.js";import{d as o,a as e,e as n,f as r}from"./p-6a81203d.js";import{Y as t,c as a}from"./p-a5a82152.js";import{s as i}from"./p-69accca0.js";import{R as c}from"./p-954d5885.js";import{b as l,y as u,t as g}from"./p-483a08e8.js";import{t as f,A as d}from"./p-0dcd6e05.js";import{C as m}from"./p-b44dc71b.js";import{f as p}from"./p-1a9f0680.js";import{t as h}from"./p-cfcd29c7.js";import{o as v,c as S,s as x,m as b,g as j}from"./p-1707b666.js";import{t as k}from"./p-73c5a77b.js";function C({onSearchSubmit:r,onSearchTextChange:t,onSearchBtnClick:a,searchText:i,showSearchbar:c,onCloseClick:l,onClickBack:u}){return s("div",{class:"search-bar"},u&&s("button",{class:"back",onClick:u},s("x-icon",{icon:n})),s("form",{class:"search-form "+(c?"":"hide"),onSubmit:s=>{s.preventDefault(),r(s)}},s("input",{type:"text",class:"search-input",value:i,placeholder:"Search",onInput:s=>{t(s)}})),c&&s("button",{class:"close",onClick:l},s("x-icon",{icon:e})),!c&&s("button",{class:"search",onClick:a},s("x-icon",{icon:o})))}function T({suggestions:o,onClickSuggesion:e,error:n,loading:t}){return s("div",{class:"suggestions-container"},n&&s("div",{class:"error"},n.message),t&&s("div",{class:"loading"},s("x-icon",{icon:r,spin:!0})),s("ul",{class:"suggestions"},!t&&!n&&o.map((o=>s("li",{key:o,onClick:()=>e(o)},o)))))}const w=u({showSearchBar:!1,searchText:"",searchResponse:{nextpage:"",results:[]},suggestions:[],suggestionsError:void 0,suggestionsLoading:!1});function y(s){w.update({suggestions:s})}function B(){w.update((s=>({showSearchBar:!s.showSearchBar,suggestions:s.showSearchBar?[]:s.suggestions})))}function P(s){w.update({searchText:s})}function A(s){w.update((o=>({suggestions:[],searchText:s||o.searchText})))}function E(s){w.update((o=>{const e=Object.assign({},o);return e.searchResponse=s,o.showSearchBar&&function(s){s.showSearchBar=!s.showSearchBar,s.showSearchBar||(s.suggestions=[])}(e),e}))}function F(s){w.update({suggestionsError:s})}function R(s){w.update({searchText:s})}function W(s){return s.pipe(h((()=>{i.update({loading:{}})})),x((()=>t.getApi().getTrendingVideos().pipe(f(c),b((s=>E({results:s,nextpage:""}))),a((()=>(i.update({loading:{message:"Trying to find Active Server. Please Wait..."}}),d.getActiveServer().pipe(k(1)).subscribe({next:s=>{m.set(s),window.location.reload()},error:()=>{i.update({error:{message:"Sorry, all Servers are down now. Try after sometime."}})}}),j(E({results:[],nextpage:""})))))).pipe(h((()=>{var s;"Trying to find Active Server. Please Wait..."!==(null===(s=i.get().loading)||void 0===s?void 0:s.message)&&i.update({loading:void 0})}))))))}const I=s=>o=>function(s,o){return s.pipe(p((s=>!!s.length)),function(s,o=l){return v(((e,n)=>{let r=null,t=null,a=null;const i=()=>{if(r){r.unsubscribe(),r=null;const s=t;t=null,n.next(s)}};function c(){const e=a+s,t=o.now();if(t<e)return r=this.schedule(void 0,e-t),void n.add(r);i()}e.subscribe(S(n,(e=>{t=e,a=o.now(),r||(r=o.schedule(c,s),n.add(r))}),(()=>{i(),n.complete()}),void 0,(()=>{t=r=null})))}))}(300),h((()=>{i.update({loading:{}}),F(void 0)})),x((s=>t.getApi().getSuggestions(s).pipe(h((s=>{y(s)})),a((()=>(F({message:"Failed to get Suggestions from the Server. Press Enter to Search"}),y([]),j([])))),h((()=>{i.update({loading:void 0})})),g(o)))))}(o,s);function L(s){return s.pipe(p((s=>!!s.length)),h((()=>{i.update({loading:{}})})),x((s=>t.getApi().getSearchResults(s).pipe(b((s=>E(s))),a((()=>(i.update({error:{message:"Failed to get response from the Server. Please try changing server from settings(in home page)"}}),j(E({results:[],nextpage:""})))))).pipe(h((()=>{i.update({loading:void 0})}))))))}export{T as S,R as a,C as b,A as c,L as d,W as f,I as g,P as k,w as s,B as t}