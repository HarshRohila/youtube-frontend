import{h as s}from"./p-27ce4408.js";import{d as o,a as e,e as n,f as r}from"./p-13637994.js";import{Y as t,c as a}from"./p-d0239e1a.js";import{s as i}from"./p-4357c78a.js";import{R as c}from"./p-954d5885.js";import{y as l,t as u}from"./p-8cb43504.js";import{g}from"./p-8832fd5c.js";import{C as f}from"./p-b44dc71b.js";import{f as m}from"./p-c2b68ac1.js";import{t as p}from"./p-c4fd8842.js";import{s as d,o as h}from"./p-e88f731b.js";import{b as v}from"./p-c1b151ee.js";import{o as b,c as S,m as x}from"./p-14a93dff.js";import{t as j,l as k}from"./p-7e3efe59.js";import{t as C}from"./p-fcbaad83.js";function y({onSearchSubmit:r,onSearchTextChange:t,onSearchBtnClick:a,searchText:i,showSearchbar:c,onCloseClick:l,onClickBack:u}){return s("div",{class:"search-bar"},u&&s("button",{class:"back",onClick:u},s("x-icon",{icon:n})),s("form",{class:"search-form "+(c?"":"hide"),onSubmit:s=>{s.preventDefault(),r(s)}},s("input",{type:"text",class:"search-input",value:i,placeholder:"Search",onInput:s=>{t(s)}})),c&&s("button",{class:"close",onClick:l},s("x-icon",{icon:e})),!c&&s("button",{class:"search",onClick:a},s("x-icon",{icon:o})))}function T({suggestions:o,onClickSuggesion:e,error:n,loading:t}){return s("div",{class:"suggestions-container"},n&&s("div",{class:"error"},n.message),t&&s("div",{class:"loading"},s("x-icon",{icon:r,spin:!0})),s("ul",{class:"suggestions"},!t&&!n&&o.map((o=>s("li",{key:o,onClick:()=>e(o)},o)))))}const w=l({showSearchBar:!1,searchText:"",searchResponse:{nextpage:"",results:[]},suggestions:[],suggestionsError:void 0,suggestionsLoading:!1});function B(s){w.update({suggestions:s})}function E(){w.update((s=>({showSearchBar:!s.showSearchBar,suggestions:s.showSearchBar?[]:s.suggestions})))}function P(s){w.update({searchText:s})}function F(s){w.update((o=>({suggestions:[],searchText:s||o.searchText})))}function R(s){w.update((o=>{const e=Object.assign({},o);return e.searchResponse=s,o.showSearchBar&&function(s){s.showSearchBar=!s.showSearchBar,s.showSearchBar||(s.suggestions=[])}(e),e}))}function A(s){w.update({suggestionsError:s})}function I(s){w.update({searchText:s})}function L(s){return s.pipe(p((()=>{i.update({loading:{}})})),d((()=>t.getApi().getTrendingVideos().pipe(j(c),x((s=>R({results:s,nextpage:""}))),a((()=>(g().pipe(C(1)).subscribe({next:async s=>{for(const o of s){i.update({loading:{message:`Trying server ${o.name}...`}});try{await k(O(o)),f.set(o),window.location.reload()}catch(s){continue}}i.update({error:{message:"Sorry, all Servers are down now. Try after sometime."},loading:void 0})}}),h(R({results:[],nextpage:""})))))).pipe(p((()=>{var s;"Trying to find Active Server. Please Wait..."!==(null===(s=i.get().loading)||void 0===s?void 0:s.message)&&i.update({loading:void 0})}))))))}function O(s){return t.getApi({baseUrl:s.apiUrl}).getTrendingVideos().pipe(j(500)).pipe(x((()=>{})))}const U=s=>o=>function(s,o){return s.pipe(m((s=>!!s.length)),function(s,o=v){return b(((e,n)=>{let r=null,t=null,a=null;const i=()=>{if(r){r.unsubscribe(),r=null;const s=t;t=null,n.next(s)}};function c(){const e=a+s,t=o.now();if(t<e)return r=this.schedule(void 0,e-t),void n.add(r);i()}e.subscribe(S(n,(e=>{t=e,a=o.now(),r||(r=o.schedule(c,s),n.add(r))}),(()=>{i(),n.complete()}),void 0,(()=>{t=r=null})))}))}(300),p((()=>{i.update({loading:{}}),A(void 0)})),d((s=>t.getApi().getSuggestions(s).pipe(p((s=>{B(s)})),a((()=>(A({message:"Failed to get Suggestions from the Server. Press Enter to Search"}),B([]),h([])))),p((()=>{i.update({loading:void 0})})),u(o)))))}(o,s);function W(s){return s.pipe(m((s=>!!s.length)),p((()=>{i.update({loading:{}})})),d((s=>t.getApi().getSearchResults(s).pipe(x((s=>R(s))),a((()=>(i.update({error:{message:"Failed to get response from the Server. Please try changing server from settings(in home page)"}}),h(R({results:[],nextpage:""})))))).pipe(p((()=>{i.update({loading:void 0})}))))))}export{T as S,I as a,y as b,F as c,W as d,L as f,U as g,P as k,w as s,E as t}